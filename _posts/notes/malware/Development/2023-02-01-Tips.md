---
title: Notes | Tips
author: Zeropio
date: 2023-02-01
categories: [Notes, Malware]
tags: [malware]
permalink: /notes/malware/tips
---

# Hiding CMD 

## FreeConsole
In order to hide the pop up CMD when executing malware we can use the function `FreeConsole();`. Using this in the `main` function before the malware start can help reducing the time the CMD appears.

## GUI Trick

Instead of using `main`, using `WinMain` can prevent it. This make Windows think the program is a GUI program instead of a CMD one. The code should look like this:
```cpp
int WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, 
    LPSTR lpCmdLine, int nCmdShow) {
    
    <PROGRAM>

}
```

> Also don't use any `printf`.
{: prompt-alert}

Also, the compilation change. Instead of compiling for **Console**:
```console
C:\Users\Zeropio>cl.exe /nologo /Ox /MT /W0 /GS- /DNDEBUG /Tc<FILE>.cpp /link /OUT:<NAME>.exe /SUBSYSTEM:CONSOLE /MACHINE:x64
```

We compile it as a Windows application:
```console
C:\Users\Zeropio>cl.exe /nologo /Ox /MT /W0 /GS- /DNDEBUG /Tc<FILE>.cpp /link /OUT:<NAME>.exe /SUBSYSTEM:WINDOWS /MACHINE:x64
```

